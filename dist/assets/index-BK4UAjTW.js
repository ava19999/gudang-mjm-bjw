import{r,j as e,h as Ut,H as Ht,R as Ft,a as Qt}from"./vendor-vDI-kFME.js";import{A as yt,X as Ne,C as at,P as Te,U as ft,L as Le,a as ye,H as He,S as ot,b as Ye,c as jt,T as Nt,D as Kt,d as fe,e as Fe,f as vt,g as Ce,h as wt,W as it,i as $e,j as kt,k as St,l as Gt,m as Jt,n as Ct,o as Pt,p as De,M as ct,q as Wt,r as st,s as rt,t as Yt,Z as Vt,u as Ee,v as Ae,w as Xt,x as Zt,y as ea,F as ta,z as It,R as aa,B as sa,E as Ve,G as ra,I as na,J as dt,K as la,N as Qe,O as oa,Q as Pe,V as ia,Y as Tt,_ as qe,$ as ca,a0 as da,a1 as xa,a2 as ua,a3 as ga,a4 as ma,a5 as pa,a6 as zt,a7 as Rt,a8 as ba}from"./icons-BLVbOzjs.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))x(l);new MutationObserver(l=>{for(const n of l)if(n.type==="childList")for(const g of n.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&x(g)}).observe(document,{childList:!0,subtree:!0});function o(l){const n={};return l.integrity&&(n.integrity=l.integrity),l.referrerPolicy&&(n.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?n.credentials="include":l.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function x(l){if(l.ep)return;l.ep=!0;const n=o(l);fetch(l.href,n)}})();const ha=[],ya=[],fa=[],Mt=async t=>Promise.resolve([...ha]),ja=async(t,a,o,x)=>Promise.resolve({data:[],total:0}),Na=async t=>Promise.resolve({totalItems:0,totalValue:0,lowStock:0}),va=async(t,a)=>Promise.resolve([]),Xe=async(t,a)=>(console.log("Mock: addInventory called",t),Promise.resolve()),Ie=async(t,a,o)=>(console.log("Mock: updateInventory called",t,a),Promise.resolve()),wa=async(t,a)=>(console.log("Mock: deleteInventory called",t),Promise.resolve()),Be=async(t,a)=>Promise.resolve(null),ka=async t=>Promise.resolve([...ya]),Dt=async(t,a)=>(console.log("Mock: saveOrder called",t),Promise.resolve()),Ke=async(t,a,o)=>(console.log("Mock: updateOrderStatusService called",t,a),Promise.resolve()),Ze=async(t,a,o)=>(console.log("Mock: updateOrderData called",t,a),Promise.resolve()),Sa=async t=>Promise.resolve([...fa]),Ca=async(t,a)=>Promise.resolve([]),Pa=async(t,a,o,x)=>Promise.resolve({data:[],total:0}),xt=async(t,a,o,x,l,n,g,s)=>(console.log("Mock: addBarangMasuk called"),Promise.resolve()),Ia=async(t,a,o,x,l,n,g,s)=>(console.log("Mock: addBarangKeluar called"),Promise.resolve()),Ta=async t=>Promise.resolve([]),za=async(t,a,o)=>Promise.resolve([]),Ra=async t=>Promise.resolve([]),Ma=async t=>Promise.resolve([]),ut=async(t,a)=>(console.log("Mock: addScanResiLog called"),Promise.resolve()),Re=async(t,a,o,x)=>(console.log("Mock: updateScanResiLogField called"),Promise.resolve()),Da=async(t,a)=>(console.log("Mock: processShipmentToOrders called"),Promise.resolve()),Ba=async(t,a)=>(console.log("Mock: duplicateScanResiLog called"),Promise.resolve()),La=async(t,a)=>(console.log("Mock: deleteScanResiLog called"),Promise.resolve()),$a=async t=>Promise.resolve([]),Aa=async(t,a,o)=>(console.log("Mock: updateReturKeterangan called"),Promise.resolve()),Oa=async(t,a)=>(console.log("Mock: addReturTransaction called"),Promise.resolve()),ge=t=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(t),gt=()=>Math.random().toString(36).substr(2,9),nt=(t,a=800,o=.7)=>new Promise((x,l)=>{const n=g=>{const s=new Image;s.src=g,s.onload=()=>{const c=document.createElement("canvas");let m=s.width,h=s.height;m>a&&(h=Math.round(h*a/m),m=a),c.width=m,c.height=h;const u=c.getContext("2d");if(!u){l(new Error("Gagal membuat context canvas"));return}u.fillStyle="#FFFFFF",u.fillRect(0,0,m,h),u.drawImage(s,0,0,m,h),x(c.toDataURL("image/jpeg",o))},s.onerror=c=>l(c)};if(typeof t=="string")n(t);else if(t instanceof File||t instanceof Blob){const g=new FileReader;g.onload=s=>{var c;(c=s.target)!=null&&c.result?n(s.target.result):l(new Error("Gagal membaca file gambar"))},g.onerror=s=>l(s),g.readAsDataURL(t)}else l(new Error("Format input gambar tidak dikenali"))}),lt={mjm:{id:"mjm",name:"MJM86",fullName:"MJM86 AUTOPART",subtitle:"Suku Cadang Mobil",logo:"/assets/mjm-logo.png",theme:{primary:"yellow-400",secondary:"cyan-400",accent:"yellow-500",hover:"yellow-300",gradient:"from-yellow-600/20 to-cyan-600/20",glow:"shadow-yellow-500/50"},adminPassword:"mjm123"},bjw:{id:"bjw",name:"BJW",fullName:"BJW AUTOPART",subtitle:"Sukucadang Mobil",logo:"/assets/bjw-logo.png",theme:{primary:"red-500",secondary:"gray-300",accent:"red-600",hover:"red-400",gradient:"from-red-600/20 to-gray-600/20",glow:"shadow-red-500/50"},adminPassword:"bjw123"}},Bt=r.createContext(void 0),Ge="stockmaster_auth_state",Ea=({children:t})=>{const[a,o]=r.useState(null),[x,l]=r.useState(null),[n,g]=r.useState("");r.useEffect(()=>{const h=localStorage.getItem(Ge);if(h)try{const u=JSON.parse(h);o(u.selectedStore),l(u.userRole),g(u.userName||"")}catch(u){console.error("Failed to parse saved auth state:",u)}},[]),r.useEffect(()=>{if(a&&x){const h={selectedStore:a,userRole:x,userName:n};localStorage.setItem(Ge,JSON.stringify(h))}},[a,x,n]);const s=h=>{o(h)},c=()=>{o(null),l(null),g(""),localStorage.removeItem(Ge)},m=()=>a?lt[a]:null;return e.jsx(Bt.Provider,{value:{selectedStore:a,userRole:x,userName:n,setStore:s,setUserRole:l,setUserName:g,logout:c,getStoreConfig:m},children:t})},Oe=()=>{const t=r.useContext(Bt);if(!t)throw new Error("useStore must be used within StoreProvider");return t},Lt=({initialData:t,onCancel:a,onSuccess:o})=>{const x=!!t,{selectedStore:l}=Oe(),[n,g]=r.useState({partNumber:"",name:"",brand:"",application:"",quantity:0,shelf:"",price:0,costPrice:0,ecommerce:"",imageUrl:"",images:[],initialStock:0,qtyIn:0,qtyOut:0}),[s,c]=r.useState("none"),[m,h]=r.useState(""),[u,i]=r.useState(""),[y,p]=r.useState(""),[z,B]=r.useState(""),[M,w]=r.useState(!1),[$,E]=r.useState(null),_=r.useRef(null),[S,G]=r.useState(!1),[J,ee]=r.useState([]),[ie,ne]=r.useState(!1),[Y,se]=r.useState(null);r.useEffect(()=>{t&&(g({partNumber:t.partNumber,name:t.name,brand:t.brand,application:t.application,quantity:t.quantity,shelf:t.shelf,price:t.price,costPrice:t.costPrice,ecommerce:t.ecommerce||"",imageUrl:t.imageUrl,images:t.images||(t.imageUrl?[t.imageUrl]:[]),initialStock:t.initialStock,qtyIn:t.qtyIn,qtyOut:t.qtyOut}),E(t.imageUrl||t.images&&t.images[0]||null))},[t]);const q=b=>{const{name:C,value:W}=b.target;g(ae=>({...ae,[C]:C==="price"||C==="costPrice"||C==="quantity"?parseFloat(W)||0:W}))},te=async b=>{const C=b.target.files;if(C&&C.length>0){w(!0);try{const W=[...n.images],ae=10-W.length;if(ae<=0){se("Maksimal 10 foto."),w(!1);return}const me=Array.from(C).slice(0,ae);for(const ue of me){const pe=await nt(ue);W.push(pe)}g(ue=>({...ue,images:W,imageUrl:W[0]||""})),E(W[0]),se(null)}catch(W){console.error(W),se("Gagal memproses gambar.")}finally{w(!1),_.current&&(_.current.value="")}}},re=b=>{const C=n.images.filter((W,ae)=>ae!==b);g(W=>({...W,images:C,imageUrl:C[0]||""})),E(C[0]||null)},xe=async()=>{if(!n.partNumber){alert("Isi Part Number terlebih dahulu!");return}ne(!0),G(!0);try{const b=await za(n.partNumber);ee(b)}catch(b){console.error(b)}ne(!1)},de=b=>{g(C=>({...C,costPrice:b})),G(!1)},j=async b=>{b.preventDefault(),w(!0),se(null);try{if(x&&t){const C=Number(m);if(s!=="none"&&C<=0){se("Mohon isi jumlah stok yang valid (lebih dari 0)."),w(!1);return}const W=s!=="none"&&C>0?{type:s==="in"?"in":"out",qty:C,ecommerce:u,resiTempo:y,customer:z}:void 0,ae=await Ie({...t,...n,images:n.images},W,l);ae?o(ae):se("Gagal update database.")}else await Xe(n,l)?o():se("Gagal tambah barang.")}catch(C){console.error(C),se("Kesalahan Sistem.")}finally{w(!1)}},N=x?s==="in"?Number(n.quantity)+(Number(m)||0):s==="out"?Number(n.quantity)-(Number(m)||0):n.quantity:n.quantity;let f="border-gray-700",v="bg-gray-900/80 border-gray-700";return n.quantity===0?(f="border-red-600",v="bg-red-900/90 border-red-700"):n.quantity<4&&(f="border-yellow-600",v="bg-yellow-900/90 border-yellow-700"),e.jsx("div",{className:"fixed inset-0 z-[80] flex items-end md:items-center justify-center bg-black/70 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("div",{className:`bg-gray-800 w-full h-[95vh] md:h-auto md:max-h-[90vh] md:max-w-4xl rounded-t-3xl md:rounded-2xl shadow-2xl flex flex-col overflow-hidden border ${f} transition-colors duration-300`,children:[e.jsxs("div",{className:`px-5 py-4 border-b flex justify-between items-center backdrop-blur-md sticky top-0 z-10 ${v} transition-colors duration-300`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:a,className:"md:hidden p-2 -ml-2 hover:bg-gray-700 rounded-full text-gray-300",children:e.jsx(yt,{size:22})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-extrabold text-gray-100 flex items-center gap-2",children:t?"Edit Barang":"Tambah Barang Baru"}),e.jsx("p",{className:"text-xs text-gray-200 hidden md:block",children:t?n.name:"Isi detail barang baru"})]})]}),e.jsx("button",{onClick:a,className:"hidden md:block p-2 hover:bg-gray-700 rounded-full text-gray-200 hover:text-white",children:e.jsx(Ne,{size:20})})]}),e.jsxs("form",{onSubmit:j,className:"flex-1 overflow-y-auto p-5 custom-scrollbar pb-24 md:pb-6 bg-gray-800",children:[Y&&e.jsxs("div",{className:"bg-red-900/30 text-red-400 p-3 rounded-xl flex items-center gap-2 text-xs border border-red-900/50 mb-5 font-bold",children:[e.jsx(at,{size:16}),Y]}),e.jsxs("div",{className:"flex flex-col lg:flex-row gap-6",children:[e.jsxs("div",{className:"w-full lg:w-1/3 flex flex-col gap-4",children:[e.jsxs("div",{className:`aspect-video lg:aspect-square w-full rounded-2xl border-2 border-dashed flex flex-col items-center justify-center transition-all relative overflow-hidden group shadow-sm bg-gray-700 ${n.images.length>0?"border-blue-500":"border-gray-600 hover:border-gray-500"}`,children:[n.images.length>0?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:n.images[0],alt:"Preview",className:"w-full h-full object-cover"}),e.jsxs("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity cursor-pointer",onClick:()=>{var b;return(b=_.current)==null?void 0:b.click()},children:[e.jsx(Te,{size:32,className:"text-white"}),e.jsx("span",{className:"text-white text-xs font-bold mt-1",children:"Tambah / Ganti"})]})]}):e.jsxs("div",{className:"text-center p-4 cursor-pointer",onClick:()=>{var b;return(b=_.current)==null?void 0:b.click()},children:[e.jsx("div",{className:"w-12 h-12 bg-gray-600 rounded-full flex items-center justify-center mx-auto mb-2 text-gray-400 shadow-sm border border-gray-500",children:e.jsx(ft,{size:20})}),e.jsx("span",{className:"text-xs font-bold text-gray-400",children:"Upload Foto"}),e.jsx("p",{className:"text-[10px] text-gray-500 mt-1",children:"Max 10 foto"})]}),e.jsx("input",{type:"file",ref:_,onChange:te,accept:"image/*",multiple:!0,className:"hidden"})]}),n.images.length>0&&e.jsxs("div",{className:"grid grid-cols-5 gap-2",children:[n.images.map((b,C)=>e.jsxs("div",{className:"relative aspect-square rounded-lg overflow-hidden border border-gray-600 group/thumb",children:[e.jsx("img",{src:b,className:"w-full h-full object-cover"}),e.jsx("button",{type:"button",onClick:()=>re(C),className:"absolute inset-0 bg-red-900/80 flex items-center justify-center opacity-0 group-hover/thumb:opacity-100 transition-opacity text-white",children:e.jsx(Ne,{size:16})})]},C)),n.images.length<10&&e.jsxs("div",{className:"aspect-square rounded-lg border border-dashed border-gray-600 flex items-center justify-center relative hover:bg-gray-700 cursor-pointer text-gray-500 hover:text-white transition-colors",children:[e.jsx(Te,{size:20}),e.jsx("input",{type:"file",multiple:!0,onChange:te,className:"absolute inset-0 opacity-0 cursor-pointer",accept:"image/*"})]})]}),!x&&e.jsxs("div",{className:"bg-blue-900/20 p-4 rounded-xl border border-blue-900/40",children:[e.jsxs("label",{className:"text-[10px] font-bold text-blue-300 uppercase mb-1 block flex items-center gap-1",children:[e.jsx(Le,{size:12})," Stok Awal"]}),e.jsx("input",{type:"number",name:"quantity",required:!0,min:"0",className:"w-full bg-gray-900 border border-blue-800 rounded-lg p-2.5 text-xl font-bold text-center text-blue-400 focus:ring-2 focus:ring-blue-800 outline-none",value:n.quantity,onChange:q})]})]}),e.jsxs("div",{className:"flex-1 space-y-5",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider border-b border-gray-700 pb-1 mb-2",children:"Info Produk"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-3 text-gray-400",children:e.jsx(ye,{size:16})}),e.jsx("input",{type:"text",name:"name",required:!0,placeholder:"Nama Barang",className:"w-full pl-10 pr-4 py-2.5 bg-gray-700 border border-gray-600 rounded-xl text-sm font-bold text-gray-100 focus:bg-gray-600 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 outline-none transition-all placeholder:font-normal placeholder-gray-400",value:n.name,onChange:q})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-gray-400 uppercase ml-1",children:"Part Number"}),e.jsx("input",{type:"text",name:"partNumber",required:!0,disabled:x,className:"w-full mt-1 px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-xs font-mono font-medium focus:bg-gray-600 focus:border-blue-500 outline-none text-gray-200 disabled:opacity-50",value:n.partNumber,onChange:q})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-gray-400 uppercase ml-1",children:"Brand"}),e.jsx("input",{type:"text",name:"brand",className:"w-full mt-1 px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-xs font-medium focus:bg-gray-600 focus:border-blue-500 outline-none text-gray-200",value:n.brand,onChange:q})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-gray-400 uppercase ml-1",children:"Aplikasi"}),e.jsx("input",{type:"text",name:"application",className:"w-full mt-1 px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-xs font-medium focus:bg-gray-600 focus:border-blue-500 outline-none text-gray-200",value:n.application,onChange:q})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-gray-400 uppercase ml-1",children:"Rak"}),e.jsx("input",{type:"text",name:"shelf",className:"w-full mt-1 px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-xs font-medium focus:bg-gray-600 focus:border-blue-500 outline-none text-gray-200",value:n.shelf,onChange:q})]})]})]}),x&&e.jsxs("div",{className:"bg-blue-900/20 p-4 rounded-2xl border border-blue-900/40",children:[e.jsxs("h3",{className:"text-sm font-bold text-blue-300 flex items-center gap-1.5 mb-3",children:[e.jsx(He,{size:16})," Mutasi Stok"]}),e.jsxs("div",{className:"flex bg-gray-900 p-1 rounded-xl border border-gray-700 shadow-sm mb-4",children:[e.jsx("button",{type:"button",onClick:()=>c("none"),className:`flex-1 py-2 text-xs font-bold rounded-lg transition-all ${s==="none"?"bg-gray-700 text-gray-200 shadow-sm":"text-gray-500 hover:bg-gray-800"}`,children:"Tetap"}),e.jsx("button",{type:"button",onClick:()=>c("in"),className:`flex-1 py-2 text-xs font-bold rounded-lg transition-all ${s==="in"?"bg-green-600 text-white shadow-md shadow-green-900":"text-gray-500 hover:text-green-400 hover:bg-gray-800"}`,children:"+ Masuk"}),e.jsx("button",{type:"button",onClick:()=>c("out"),className:`flex-1 py-2 text-xs font-bold rounded-lg transition-all ${s==="out"?"bg-red-600 text-white shadow-md shadow-red-900":"text-gray-500 hover:text-red-400 hover:bg-gray-800"}`,children:"- Keluar"})]}),s!=="none"&&e.jsxs("div",{className:"space-y-3 animate-in fade-in slide-in-from-top-2",children:[e.jsxs("div",{className:"flex gap-4 items-end",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("label",{className:"text-[10px] font-bold text-gray-400 uppercase block mb-1",children:["Jumlah ",s==="in"?"Masuk":"Keluar"]}),e.jsx("input",{type:"number",required:!0,min:"1",value:m,onChange:b=>h(b.target.value),className:"w-full px-3 py-2.5 bg-gray-900 border-2 border-blue-900/50 rounded-xl text-lg font-bold text-gray-100 focus:border-blue-500 focus:ring-4 focus:ring-blue-900/20 outline-none transition-all placeholder-gray-600",placeholder:"0"})]}),e.jsxs("div",{className:"pb-3 text-right",children:[e.jsx("span",{className:"text-[10px] text-gray-500 font-bold uppercase block mb-0.5",children:"Estimasi Akhir"}),e.jsx("span",{className:`text-2xl font-extrabold ${s==="in"?"text-green-400":"text-red-400"}`,children:N})]})]}),s==="in"?e.jsxs("div",{className:"grid grid-cols-3 gap-3 pt-1",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"text-[10px] font-bold text-gray-400 uppercase block mb-1 flex items-center gap-1",children:[e.jsx(ot,{size:10})," Via / Sumber"]}),e.jsx("input",{type:"text",placeholder:"Tokopedia",value:u,onChange:b=>i(b.target.value),className:"w-full px-3 py-2 bg-gray-900 border border-gray-700 rounded-lg text-sm text-gray-200 focus:border-blue-500 outline-none placeholder-gray-600"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-[10px] font-bold text-gray-400 uppercase block mb-1 flex items-center gap-1",children:[e.jsx(Ye,{size:10})," Customer"]}),e.jsx("input",{type:"text",placeholder:"Nama...",value:z,onChange:b=>B(b.target.value),className:"w-full px-3 py-2 bg-gray-900 border border-gray-700 rounded-lg text-sm text-gray-200 focus:border-blue-500 outline-none placeholder-gray-600"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-[10px] font-bold text-gray-400 uppercase block mb-1 flex items-center gap-1",children:[e.jsx(jt,{size:10})," Tempo"]}),e.jsx("input",{type:"text",placeholder:"Lunas / 30 Hari",value:y,onChange:b=>p(b.target.value),className:"w-full px-3 py-2 bg-gray-900 border border-gray-700 rounded-lg text-sm text-gray-200 focus:border-blue-500 outline-none placeholder-gray-600"})]})]}):e.jsxs("div",{className:"space-y-3 pt-1",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"text-[10px] font-bold text-gray-400 uppercase block mb-1 flex items-center gap-1",children:[e.jsx(Ye,{size:10})," Penerima / Customer"]}),e.jsx("input",{type:"text",placeholder:"Nama Bengkel / Pembeli...",value:z,onChange:b=>B(b.target.value),className:"w-full px-3 py-2 bg-gray-900 border border-gray-700 rounded-lg text-sm text-gray-200 focus:border-blue-500 outline-none placeholder-gray-600"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"text-[10px] font-bold text-gray-400 uppercase block mb-1 flex items-center gap-1",children:[e.jsx(ot,{size:10})," Via / Sumber"]}),e.jsx("input",{type:"text",placeholder:"Shopee",value:u,onChange:b=>i(b.target.value),className:"w-full px-3 py-2 bg-gray-900 border border-gray-700 rounded-lg text-sm text-gray-200 focus:border-blue-500 outline-none placeholder-gray-600"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-[10px] font-bold text-gray-400 uppercase block mb-1 flex items-center gap-1",children:[e.jsx(Nt,{size:10})," Resi"]}),e.jsx("input",{type:"text",placeholder:"JP...",value:y,onChange:b=>p(b.target.value),className:"w-full px-3 py-2 bg-gray-900 border border-gray-700 rounded-lg text-sm text-gray-200 focus:border-blue-500 outline-none placeholder-gray-600"})]})]})]})]})]}),e.jsxs("div",{className:"bg-gray-700 p-4 rounded-2xl border border-gray-600 space-y-4",children:[e.jsxs("h3",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider flex items-center gap-1",children:[e.jsx(Kt,{size:12})," Harga"]}),e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"text-[10px] font-bold text-gray-400 uppercase ml-1",children:"Harga Modal (Satuan)"}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsx("input",{type:"number",name:"costPrice",value:n.costPrice,onChange:q,className:"flex-1 px-3 py-2 bg-orange-900/20 text-orange-300 font-mono font-bold text-sm rounded-lg border border-orange-900/50 focus:ring-2 focus:ring-orange-800 outline-none placeholder-orange-800"}),e.jsx("button",{type:"button",onClick:xe,className:"px-3 py-2 bg-gray-800 border border-gray-600 text-gray-400 rounded-lg hover:bg-gray-600 hover:text-white",children:e.jsx(He,{size:18})})]}),S&&e.jsxs("div",{className:"absolute top-full left-0 right-0 mt-2 bg-gray-800 shadow-xl border border-gray-600 rounded-xl z-20 max-h-40 overflow-y-auto",children:[J.length>0?J.map((b,C)=>e.jsxs("div",{onClick:()=>de(b.price),className:"p-2.5 border-b border-gray-700 text-xs flex justify-between hover:bg-gray-700 cursor-pointer items-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-blue-300 mb-0.5",children:b.source}),e.jsx("div",{className:"text-[10px] text-gray-500",children:b.date})]}),e.jsx("div",{className:"font-mono font-bold text-gray-200",children:ge(b.price)})]},C)):e.jsx("div",{className:"p-3 text-center text-xs text-gray-500",children:"Belum ada riwayat"}),e.jsx("div",{className:"p-2 sticky bottom-0 bg-gray-800/95 border-t border-gray-700",children:e.jsx("button",{onClick:()=>G(!1),className:"w-full py-1.5 text-[10px] text-gray-400 hover:text-gray-200 font-bold uppercase",children:"Tutup"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-gray-400 uppercase ml-1",children:"Harga Jual"}),e.jsx("input",{type:"number",name:"price",value:n.price,onChange:q,className:"w-full mt-1 px-3 py-2 bg-blue-900/20 text-blue-300 font-mono font-bold text-sm rounded-lg border border-blue-900/50 focus:ring-2 focus:ring-blue-800 outline-none"})]})]})]})]})]}),e.jsxs("div",{className:"p-4 bg-gray-800 border-t border-gray-700 flex gap-3 sticky bottom-0 z-20 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.2)] safe-area-bottom",children:[e.jsx("button",{onClick:a,className:"flex-1 py-3 bg-gray-700 border border-gray-600 text-gray-300 font-bold rounded-xl hover:bg-gray-600 text-sm",children:"Batal"}),e.jsxs("button",{onClick:j,disabled:M,className:"flex-[2] py-3 bg-blue-600 text-white font-bold rounded-xl hover:bg-blue-700 flex items-center justify-center gap-2 disabled:opacity-70 text-sm shadow-lg shadow-blue-900/50",children:[M?e.jsx(fe,{size:18,className:"animate-spin"}):e.jsx(Fe,{size:18})," Simpan"]})]})]})})},et=t=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",maximumFractionDigits:0}).format(t||0),Me=(t,a=!0)=>{const o=t||0;return o>=1e9?(o/1e9).toFixed(1)+"M":o>=1e6?(o/1e6).toFixed(1)+"jt":a?et(o):new Intl.NumberFormat("id-ID",{maximumFractionDigits:0}).format(o)},mt=t=>t===0?"bg-red-900/30 border-red-800 hover:border-red-600":t<4?"bg-yellow-500/10 border-yellow-500 hover:border-yellow-400":"bg-gray-800 border-gray-700 hover:border-gray-600",$t=t=>{let a=t.resi||"-",o="-",x="-",l=t.reason||"",n=t.tempo||"-";const g=l.match(/\(Resi: (.*?)\)/);g&&g[1]&&(a=g[1],l=l.replace(/\s*\(Resi:.*?\)/,""));const s=l.match(/\(Via: (.*?)\)/);s&&s[1]&&(o=s[1],l=l.replace(/\s*\(Via:.*?\)/,"")),l=l.replace(/\s*\(\-\)/,"").replace(/\s*\(\)/,"").trim();let c="",m=!1;t.customer&&t.customer!=="-"&&t.customer!==""&&(x=t.customer),t.type==="out"?(x==="-"&&l&&(x=l.replace(/\s*\(.*?\)/g,"").trim()),c="Terjual"):l.toLowerCase().includes("retur")||l.toLowerCase().includes("cancel")?(m=!0,c="RETUR",x==="-"&&(x=l.replace(/\s*\(RETUR\)/i,"").replace(/\s*\(CANCEL\)/i,"").replace(/\s*\(.*?\)/g,"").trim())):["Manual Restock","Restock","Stok Awal","System Log","Opname","Adjustment"].some(y=>y.toLowerCase()===l.toLowerCase())||l===""?c=l===""||l==="Manual Restock"?"Restock":l:(x==="-"&&(x=l),c="Restock");let h="-";if(n.includes("/")){const u=n.split("/");u.length>=2?(a=u[0].trim(),h=u[1].trim()):n!=="-"&&n!==""&&n!=="AUTO"&&n!=="APP"&&(h=n)}else n!=="-"&&n!==""&&n!=="AUTO"&&n!=="APP"?h=n:o!=="-"&&o!=="Lainnya"&&o!=="APP"&&o!=="SYSTEM"&&(h=o);return{resi:a,subInfo:h,customer:x,keterangan:c,ecommerce:o,isRetur:m}},qa=({stats:t,onShowDetail:a})=>e.jsx("div",{className:"bg-gray-800 border-b border-gray-700 sticky top-0 z-20 shadow-md",children:e.jsx("div",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex gap-3 overflow-x-auto scrollbar-hide snap-x md:grid md:grid-cols-5 md:overflow-visible",children:[e.jsxs("div",{className:"min-w-[140px] snap-start bg-gradient-to-br from-blue-900/40 to-gray-800 p-3 rounded-xl border border-blue-900/50 flex flex-col justify-between h-24 md:w-auto",children:[e.jsxs("div",{className:"flex items-center gap-2 text-blue-400 mb-1",children:[e.jsx("div",{className:"p-1.5 bg-blue-900/50 rounded-lg",children:e.jsx(ye,{size:14})}),e.jsx("span",{className:"text-[10px] font-bold uppercase tracking-wider",children:"Item"})]}),e.jsx("div",{className:"text-2xl font-extrabold text-white",children:Me(t.totalItems,!1)})]}),e.jsxs("div",{className:"min-w-[140px] snap-start bg-gradient-to-br from-purple-900/40 to-gray-800 p-3 rounded-xl border border-purple-900/50 flex flex-col justify-between h-24 md:w-auto",children:[e.jsxs("div",{className:"flex items-center gap-2 text-purple-400 mb-1",children:[e.jsx("div",{className:"p-1.5 bg-purple-900/50 rounded-lg",children:e.jsx(Le,{size:14})}),e.jsx("span",{className:"text-[10px] font-bold uppercase tracking-wider",children:"Stok"})]}),e.jsx("div",{className:"text-2xl font-extrabold text-white",children:Me(t.totalStock,!1)})]}),e.jsxs("button",{onClick:()=>a("in"),className:"min-w-[130px] snap-start bg-gray-800 p-3 rounded-xl border border-gray-700 flex flex-col justify-between h-24 active:scale-95 transition-transform md:w-auto text-left hover:border-green-700/50 hover:bg-gray-750",children:[e.jsx("div",{className:"flex items-center justify-between w-full",children:e.jsxs("div",{className:"flex items-center gap-2 text-green-500",children:[e.jsx("div",{className:"p-1.5 bg-green-900/30 rounded-lg",children:e.jsx(vt,{size:14})}),e.jsx("span",{className:"text-[10px] font-bold uppercase",children:"Masuk"})]})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xl font-extrabold text-white",children:t.todayIn}),e.jsxs("div",{className:"text-[9px] text-green-500 font-medium flex items-center",children:["Lihat Detail ",e.jsx(Ce,{size:10})]})]})]}),e.jsxs("button",{onClick:()=>a("out"),className:"min-w-[130px] snap-start bg-gray-800 p-3 rounded-xl border border-gray-700 flex flex-col justify-between h-24 active:scale-95 transition-transform md:w-auto text-left hover:border-red-700/50 hover:bg-gray-750",children:[e.jsx("div",{className:"flex items-center justify-between w-full",children:e.jsxs("div",{className:"flex items-center gap-2 text-red-500",children:[e.jsx("div",{className:"p-1.5 bg-red-900/30 rounded-lg",children:e.jsx(wt,{size:14})}),e.jsx("span",{className:"text-[10px] font-bold uppercase",children:"Keluar"})]})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xl font-extrabold text-white",children:t.todayOut}),e.jsxs("div",{className:"text-[9px] text-red-500 font-medium flex items-center",children:["Lihat Detail ",e.jsx(Ce,{size:10})]})]})]}),e.jsxs("div",{className:"min-w-[180px] snap-start bg-gradient-to-br from-gray-950 to-gray-800 p-3 rounded-xl shadow-md text-white flex flex-col justify-between h-24 relative overflow-hidden md:w-auto border border-gray-700",children:[e.jsx("div",{className:"absolute right-0 top-0 p-2 opacity-10",children:e.jsx(it,{size:48})}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-400 mb-1",children:[e.jsx(it,{size:14}),e.jsx("span",{className:"text-[10px] font-bold uppercase tracking-wider",children:"Nilai Aset"})]}),e.jsx("div",{className:"text-xl font-bold tracking-tight text-white truncate",children:Me(t.totalAsset)})]})]})})}),_a=({searchTerm:t,setSearchTerm:a,brandSearch:o,setBrandSearch:x,appSearch:l,setAppSearch:n,filterType:g,setFilterType:s,viewMode:c,setViewMode:m,priceSort:h,setPriceSort:u,onAddNew:i})=>e.jsx("div",{className:"bg-gray-800 border-b border-gray-700 shadow-md",children:e.jsxs("div",{className:"px-4 pb-3 pt-2",children:[e.jsxs("div",{className:"flex gap-2 items-center mb-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx($e,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:16}),e.jsx("input",{type:"text",placeholder:"Cari nama / part number...",onChange:y=>a(y.target.value),className:"w-full pl-10 pr-4 py-2.5 bg-gray-700 border border-gray-600 rounded-xl text-sm font-medium focus:ring-2 focus:ring-blue-500/50 outline-none text-white placeholder-gray-400"})]}),e.jsx("button",{onClick:i,className:"bg-blue-600 text-white p-2.5 rounded-xl shadow-md hover:bg-blue-700 active:scale-95 transition-all",children:e.jsx(Te,{size:20})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(kt,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:14}),e.jsx("input",{type:"text",placeholder:"Filter Brand...",value:o,onChange:y=>x(y.target.value),className:"w-full pl-9 pr-3 py-2 bg-gray-700 border border-gray-600 rounded-xl text-xs font-medium focus:ring-2 focus:ring-blue-500/50 outline-none text-white placeholder-gray-500"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(St,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:14}),e.jsx("input",{type:"text",placeholder:"Filter Aplikasi...",value:l,onChange:y=>n(y.target.value),className:"w-full pl-9 pr-3 py-2 bg-gray-700 border border-gray-600 rounded-xl text-xs font-medium focus:ring-2 focus:ring-blue-500/50 outline-none text-white placeholder-gray-500"})]})]}),e.jsxs("div",{className:"relative mb-2",children:[e.jsx(Gt,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:14}),e.jsxs("select",{value:h,onChange:y=>u(y.target.value),className:"w-full pl-9 pr-3 py-2 bg-gray-700 border border-gray-600 rounded-xl text-xs font-medium focus:ring-2 focus:ring-blue-500/50 outline-none text-white appearance-none cursor-pointer",children:[e.jsx("option",{value:"none",children:"Urutkan Harga..."}),e.jsx("option",{value:"asc",children:"Harga: Termurah ke Termahal"}),e.jsx("option",{value:"desc",children:"Harga: Termahal ke Termurah"})]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex gap-2 overflow-x-auto scrollbar-hide py-1",children:[e.jsx("button",{onClick:()=>s("all"),className:`px-4 py-1.5 rounded-full text-[11px] font-bold transition-all border whitespace-nowrap ${g==="all"?"bg-gray-700 text-white border-gray-600":"bg-gray-800 text-gray-400 border-gray-700 hover:bg-gray-700"}`,children:"Semua"}),e.jsxs("button",{onClick:()=>s("low"),className:`px-4 py-1.5 rounded-full text-[11px] font-bold transition-all border whitespace-nowrap flex items-center gap-1 ${g==="low"?"bg-yellow-400 text-black border-yellow-500":"bg-gray-800 text-gray-400 border-gray-700 hover:bg-gray-700"}`,children:[e.jsx(Jt,{size:12})," Menipis"]}),e.jsxs("button",{onClick:()=>s("empty"),className:`px-4 py-1.5 rounded-full text-[11px] font-bold transition-all border whitespace-nowrap flex items-center gap-1 ${g==="empty"?"bg-red-900/30 text-red-400 border-red-900/50":"bg-gray-800 text-gray-400 border-gray-700 hover:bg-gray-700"}`,children:[e.jsx(at,{size:12})," Habis"]})]}),e.jsxs("div",{className:"flex bg-gray-800 p-1 rounded-lg ml-2 border border-gray-700",children:[e.jsx("button",{onClick:()=>m("grid"),className:`p-1.5 rounded-md ${c==="grid"?"bg-gray-700 shadow-sm text-blue-400":"text-gray-500 hover:text-gray-300"}`,children:e.jsx(Ct,{size:16})}),e.jsx("button",{onClick:()=>m("list"),className:`p-1.5 rounded-md ${c==="list"?"bg-gray-700 shadow-sm text-blue-400":"text-gray-500 hover:text-gray-300"}`,children:e.jsx(Pt,{size:16})})]})]})]})}),At=({images:t,initialIndex:a=0,isOpen:o,onClose:x})=>{const[l,n]=r.useState(a);if(!o||!t||t.length===0)return null;const g=c=>{c.stopPropagation(),n(m=>(m+1)%t.length)},s=c=>{c.stopPropagation(),n(m=>(m-1+t.length)%t.length)};return e.jsxs("div",{className:"fixed inset-0 z-[100] bg-black/95 backdrop-blur-sm flex flex-col items-center justify-center animate-in fade-in duration-200",onClick:x,children:[e.jsx("button",{onClick:x,className:"absolute top-4 right-4 p-2 bg-gray-800/50 hover:bg-gray-700 text-white rounded-full z-20 transition-colors border border-gray-600",children:e.jsx(Ne,{size:24})}),e.jsxs("div",{className:"relative w-full h-full max-w-5xl max-h-[85vh] flex items-center justify-center p-4",children:[e.jsx("img",{src:t[l],alt:`View ${l+1}`,className:"max-w-full max-h-full object-contain rounded-lg shadow-2xl transition-transform duration-300",onClick:c=>c.stopPropagation()}),t.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:s,className:"absolute left-2 md:left-4 p-3 bg-black/40 hover:bg-black/70 text-white rounded-full transition-colors backdrop-blur-sm border border-white/10",children:e.jsx(De,{size:32})}),e.jsx("button",{onClick:g,className:"absolute right-2 md:right-4 p-3 bg-black/40 hover:bg-black/70 text-white rounded-full transition-colors backdrop-blur-sm border border-white/10",children:e.jsx(Ce,{size:32})})]})]}),t.length>1&&e.jsx("div",{className:"absolute bottom-6 flex gap-2 overflow-x-auto max-w-[95vw] p-2 bg-black/50 rounded-xl backdrop-blur-md border border-white/10",onClick:c=>c.stopPropagation(),children:t.map((c,m)=>e.jsx("button",{onClick:()=>n(m),className:`w-14 h-14 rounded-lg overflow-hidden border-2 transition-all flex-shrink-0 ${m===l?"border-blue-500 scale-105 opacity-100":"border-transparent opacity-50 hover:opacity-100"}`,children:e.jsx("img",{src:c,className:"w-full h-full object-cover"})},m))}),e.jsxs("div",{className:"absolute top-4 left-4 bg-black/50 text-white px-3 py-1 rounded-full text-xs font-bold border border-white/10",children:[l+1," / ",t.length]})]})},Ua=({loading:t,items:a,viewMode:o,page:x,totalPages:l,setPage:n,onEdit:g,onDelete:s,onShowHistory:c})=>{const[m,h]=r.useState([]),[u,i]=r.useState(!1),y=(p,z)=>{p.stopPropagation();const B=z.images&&z.images.length>0?z.images:z.imageUrl?[z.imageUrl]:[];B.length>0&&(h(B),i(!0))};return t?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-gray-500",children:[e.jsx(fe,{size:32,className:"animate-spin mb-3 text-blue-500"}),e.jsx("p",{className:"text-xs font-medium",children:"Memuat Data Gudang..."})]}):!a||a.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-gray-500 border-2 border-dashed border-gray-700 rounded-2xl bg-gray-800/50",children:[e.jsx(ye,{size:40,className:"opacity-20 mb-3"}),e.jsx("p",{className:"text-sm",children:"Tidak ada barang ditemukan"})]}):e.jsxs(e.Fragment,{children:[e.jsx(At,{isOpen:u,images:m,onClose:()=>i(!1)}),o==="grid"?e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-3",children:a.map(p=>e.jsxs("div",{className:`rounded-xl shadow-none border overflow-hidden flex flex-col transition-all ${mt(p.quantity)}`,children:[e.jsxs("div",{className:"aspect-[4/3] relative bg-gray-700 cursor-pointer group",onClick:()=>c(p),children:[p.imageUrl?e.jsx("img",{src:p.imageUrl,alt:p.name,className:"w-full h-full object-cover transition-transform duration-500 group-hover:scale-110 cursor-zoom-in",referrerPolicy:"no-referrer",onClick:z=>y(z,p),onError:z=>{z.target.style.display="none"}}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-600",children:e.jsx(ye,{size:24})}),e.jsx("div",{className:"absolute top-2 left-2 flex flex-col gap-1 pointer-events-none",children:e.jsx("span",{className:`px-2 py-0.5 rounded-md text-[9px] font-bold shadow-sm border ${p.quantity===0?"bg-red-600 text-white border-red-700":p.quantity<4?"bg-yellow-400 text-black border-yellow-500":"bg-gray-900/90 text-white backdrop-blur border-gray-700"}`,children:p.quantity===0?"HABIS":`${p.quantity} Unit`})}),p.images&&p.images.length>1&&e.jsxs("div",{className:"absolute bottom-2 left-2 bg-black/60 backdrop-blur text-white px-1.5 py-0.5 rounded text-[9px] flex items-center gap-1",children:[e.jsx(Le,{size:10})," ",p.images.length]}),e.jsxs("div",{className:"absolute bottom-2 right-2 bg-black/60 backdrop-blur text-white px-1.5 py-0.5 rounded text-[9px] flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx(He,{size:10})," Riwayat"]})]}),e.jsxs("div",{className:"p-3 flex-1 flex flex-col",children:[e.jsxs("div",{className:"mb-2",children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsx("span",{className:"text-xs font-bold text-white bg-black px-1.5 py-0.5 rounded border border-black",children:p.partNumber}),e.jsxs("span",{className:"text-[9px] font-bold text-gray-500 flex items-center gap-0.5",children:[e.jsx(ct,{size:8})," ",p.shelf]})]}),e.jsx("h3",{className:"font-bold text-gray-200 text-xs leading-snug line-clamp-2 min-h-[2.5em]",children:p.name}),e.jsxs("div",{className:"flex flex-wrap gap-1 mt-1.5 mb-2",children:[p.brand&&e.jsx("span",{className:"text-[9px] px-1.5 py-0.5 bg-gray-700 text-gray-300 rounded font-medium border border-gray-600",children:p.brand}),p.application&&e.jsx("span",{className:"text-[9px] px-1.5 py-0.5 bg-blue-900/30 text-blue-300 rounded font-medium border border-blue-900/50",children:p.application})]})]}),e.jsxs("div",{className:"mt-auto border-t border-gray-700 pt-2",children:[e.jsx("div",{className:"text-sm font-extrabold text-blue-400 mb-2",children:Me(p.price)}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("button",{onClick:()=>g(p),className:"py-1.5 bg-blue-900/20 text-blue-400 rounded-lg text-[10px] font-bold hover:bg-blue-900/40 transition-colors border border-blue-900/30",children:"Edit"}),e.jsx("button",{onClick:()=>s(p.id),className:"py-1.5 bg-red-900/20 text-red-400 rounded-lg text-[10px] font-bold hover:bg-red-900/40 transition-colors border border-red-900/30",children:"Hapus"})]})]})]})]},p.id))}):e.jsx("div",{className:"flex flex-col gap-3",children:a.map(p=>e.jsxs("div",{className:`rounded-xl p-3 border shadow-none flex items-center gap-3 ${mt(p.quantity)}`,children:[e.jsxs("div",{className:"w-16 h-16 bg-gray-700 rounded-lg overflow-hidden flex-shrink-0 cursor-pointer relative group",onClick:z=>y(z,p),children:[p.imageUrl?e.jsx("img",{src:p.imageUrl,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-600",children:e.jsx(ye,{size:20})}),p.images&&p.images.length>1&&e.jsxs("div",{className:"absolute bottom-1 right-1 bg-black/70 text-white text-[8px] px-1 rounded flex items-center gap-0.5",children:[e.jsx(Le,{size:8})," ",p.images.length]})]}),e.jsxs("div",{className:"flex-1 min-w-0",onClick:()=>c(p),children:[e.jsxs("div",{className:"flex items-center gap-2 mb-0.5",children:[e.jsx("span",{className:"text-xs font-bold text-white bg-black px-1.5 py-0.5 rounded border border-black",children:p.partNumber}),e.jsxs("span",{className:`text-[9px] font-bold px-1.5 rounded ${p.quantity===0?"bg-red-900/40 text-red-400 border border-red-900/50":p.quantity<4?"bg-yellow-400 text-black border-yellow-500":"bg-green-900/30 text-green-400 border border-green-900/50"}`,children:[p.quantity," Unit"]})]}),e.jsx("h3",{className:"font-bold text-sm text-gray-200 truncate",children:p.name}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mt-1 text-[10px] text-gray-400",children:[p.brand&&e.jsx("span",{className:"bg-gray-700 text-gray-300 px-1.5 py-0.5 rounded border border-gray-600 font-medium",children:p.brand}),p.application&&e.jsx("span",{className:"bg-blue-900/30 text-blue-300 px-1.5 py-0.5 rounded border border-blue-900/50 font-medium",children:p.application}),e.jsxs("span",{className:"flex items-center gap-1 ml-1",children:[e.jsx(ct,{size:10})," Rak: ",e.jsx("b",{children:p.shelf||"-"})]})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2 pl-2",children:[e.jsx("div",{className:"font-extrabold text-blue-400 text-sm",children:Me(p.price)}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>g(p),className:"p-1.5 bg-gray-700 rounded text-gray-400 hover:text-blue-400 hover:bg-gray-600 border border-gray-600",children:e.jsx(Wt,{size:16})}),e.jsx("button",{onClick:()=>s(p.id),className:"p-1.5 bg-gray-700 rounded text-gray-400 hover:text-red-400 hover:bg-gray-600 border border-gray-600",children:e.jsx(st,{size:16})})]})]})]},p.id))}),e.jsxs("div",{className:"flex justify-between items-center mt-6 bg-gray-800/90 backdrop-blur p-3 rounded-2xl shadow-lg border border-gray-700 sticky bottom-4 z-10 max-w-sm mx-auto",children:[e.jsx("button",{onClick:()=>n(p=>Math.max(1,p-1)),disabled:x===1,className:"w-8 h-8 flex items-center justify-center rounded-full bg-gray-700 hover:bg-gray-600 text-gray-300 disabled:opacity-30 disabled:hover:bg-gray-700",children:e.jsx(De,{size:18})}),e.jsxs("span",{className:"text-xs font-medium text-gray-400",children:["Hal ",e.jsx("b",{className:"text-white",children:x})," / ",l]}),e.jsx("button",{onClick:()=>n(p=>Math.min(l,p+1)),disabled:x===l,className:"w-8 h-8 flex items-center justify-center rounded-full bg-gray-700 hover:bg-gray-600 text-gray-300 disabled:opacity-30 disabled:hover:bg-gray-700",children:e.jsx(Ce,{size:18})})]})]})},Ot=({data:t})=>e.jsx("div",{className:"overflow-x-auto rounded-lg border border-gray-700",children:e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{className:"bg-gray-800 text-[10px] font-bold text-gray-400 uppercase tracking-wider border-b border-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 border-r border-gray-700 w-24",children:"Tanggal"}),e.jsx("th",{className:"px-3 py-2 border-r border-gray-700 w-32",children:"Resi / Toko"}),e.jsx("th",{className:"px-3 py-2 border-r border-gray-700 w-36",children:"Via"}),e.jsx("th",{className:"px-3 py-2 border-r border-gray-700 w-32",children:"Pelanggan"}),e.jsx("th",{className:"px-3 py-2 border-r border-gray-700 w-28",children:"Part No"}),e.jsx("th",{className:"px-3 py-2 border-r border-gray-700",children:"Barang"}),e.jsx("th",{className:"px-3 py-2 border-r border-gray-700 text-right w-16",children:"Qty"}),e.jsx("th",{className:"px-3 py-2 border-r border-gray-700 text-right w-24",children:"Satuan"}),e.jsx("th",{className:"px-3 py-2 border-r border-gray-700 text-right w-24",children:"Total"}),e.jsx("th",{className:"px-3 py-2 text-center w-28",children:"Keterangan"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-700 text-xs bg-gray-900/30",children:t.map((a,o)=>{const{resi:x,subInfo:l,customer:n,ecommerce:g,keterangan:s,isRetur:c}=$t(a);let m="bg-gray-700 text-gray-300 border-gray-600";return a.type==="in"?c?m="bg-red-900/30 text-red-400 border-red-800":m="bg-green-900/30 text-green-400 border-green-800":a.type==="out"&&(m="bg-blue-900/30 text-blue-400 border-blue-800"),e.jsxs("tr",{className:"hover:bg-blue-900/10 transition-colors group",children:[e.jsxs("td",{className:"px-3 py-2 align-top border-r border-gray-700 whitespace-nowrap text-gray-400",children:[e.jsx("div",{className:"font-bold text-gray-200",children:new Date(a.timestamp||0).toLocaleDateString("id-ID",{day:"2-digit",month:"2-digit",year:"2-digit"})}),e.jsx("div",{className:"text-[9px] opacity-70 font-mono",children:new Date(a.timestamp||0).toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit"})})]}),e.jsx("td",{className:"px-3 py-2 align-top border-r border-gray-700 font-mono text-[10px]",children:e.jsxs("div",{className:"flex flex-col items-start gap-2",children:[e.jsx("span",{className:`px-1.5 py-0.5 rounded w-fit font-bold border ${x!=="-"?"bg-blue-900/30 text-blue-400 border-blue-800":"text-gray-500 bg-gray-800 border-gray-600"}`,children:x!=="-"?x:"-"}),l!=="-"?e.jsxs("div",{className:"flex items-center gap-1 text-gray-400 bg-gray-800 px-1.5 py-0.5 rounded border border-gray-600 w-fit",children:[e.jsx(rt,{size:8}),e.jsx("span",{className:"uppercase truncate max-w-[90px]",children:l})]}):null]})}),e.jsx("td",{className:"px-3 py-2 align-top border-r border-gray-700",children:g!=="-"?e.jsx("span",{className:"px-1.5 py-0.5 rounded bg-orange-900/30 text-orange-400 text-[9px] font-bold border border-orange-800 break-words",children:g}):e.jsx("span",{className:"text-gray-600",children:"-"})}),e.jsx("td",{className:"px-3 py-2 align-top border-r border-gray-700 text-gray-300 font-medium",children:n!=="-"?n:"-"}),e.jsx("td",{className:"px-3 py-2 align-top border-r border-gray-700 font-mono text-[10px] text-gray-400",children:a.partNumber}),e.jsx("td",{className:"px-3 py-2 align-top border-r border-gray-700",children:e.jsx("div",{className:"font-bold text-gray-200 text-xs",children:a.name})}),e.jsxs("td",{className:`px-3 py-2 align-top border-r border-gray-700 text-right font-bold ${a.type==="in"?"text-green-400":"text-red-400"}`,children:[a.type==="in"?"+":"-",a.quantity]}),e.jsx("td",{className:"px-3 py-2 align-top border-r border-gray-700 text-right font-mono text-[10px] text-gray-400",children:et(a.price)}),e.jsx("td",{className:"px-3 py-2 align-top border-r border-gray-700 text-right font-mono text-[10px] font-bold text-gray-200",children:et(a.totalPrice||(a.price||0)*a.quantity)}),e.jsx("td",{className:"px-3 py-2 align-top text-center",children:e.jsx("span",{className:`px-2 py-0.5 rounded text-[10px] font-bold uppercase border ${m}`,children:s})})]},a.id||o)})})]})}),Ha=({type:t,onClose:a})=>{const[o,x]=r.useState([]),[l,n]=r.useState(1),[g,s]=r.useState(1),[c,m]=r.useState(""),[h,u]=r.useState(!1);return r.useEffect(()=>{u(!0);const i=setTimeout(async()=>{const{data:y,count:p}=await Pa();x(y),s(Math.ceil(p/50)),u(!1)},500);return()=>clearTimeout(i)},[t,l,c]),e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm animate-in fade-in",children:e.jsxs("div",{className:"bg-gray-800 rounded-2xl w-full max-w-6xl h-[85vh] flex flex-col border border-gray-700 shadow-2xl m-4",children:[e.jsxs("div",{className:"p-4 border-b border-gray-700 flex justify-between items-center bg-gray-900/50 rounded-t-2xl",children:[e.jsxs("h3",{className:"font-bold text-gray-100 flex items-center gap-2",children:[t==="in"?e.jsx(vt,{className:"text-green-500",size:20}):e.jsx(wt,{className:"text-red-500",size:20})," Detail Barang ",t==="in"?"Masuk":"Keluar"]}),e.jsx("button",{onClick:a,className:"p-1 hover:bg-gray-700 rounded-full",children:e.jsx(Ne,{size:20})})]}),e.jsx("div",{className:"p-3 border-b border-gray-700 bg-gray-800",children:e.jsx("input",{type:"text",placeholder:"Cari Resi / Nama Barang...",className:"w-full bg-gray-900 border border-gray-700 rounded-lg px-3 py-2 text-sm text-gray-200 focus:border-blue-500 outline-none",value:c,onChange:i=>m(i.target.value)})}),e.jsx("div",{className:"flex-1 overflow-auto bg-gray-900/30 p-2",children:h?e.jsx("div",{className:"flex justify-center py-10",children:e.jsx(fe,{className:"animate-spin text-blue-500",size:30})}):o.length===0?e.jsx("div",{className:"text-center py-10 text-gray-500",children:"Tidak ada data history"}):e.jsx(Ot,{data:o})}),e.jsxs("div",{className:"p-3 border-t border-gray-700 flex justify-between items-center bg-gray-800 rounded-b-2xl",children:[e.jsx("button",{onClick:()=>n(i=>Math.max(1,i-1)),disabled:l===1,className:"p-1 bg-gray-700 rounded disabled:opacity-30",children:e.jsx(De,{size:18})}),e.jsxs("span",{className:"text-xs text-gray-400",children:["Hal ",l," / ",g]}),e.jsx("button",{onClick:()=>n(i=>Math.min(g,i+1)),disabled:l===g,className:"p-1 bg-gray-700 rounded disabled:opacity-30",children:e.jsx(Ce,{size:18})})]})]})})},Fa=({item:t,onClose:a})=>{const[o,x]=r.useState([]),[l,n]=r.useState(!1),[g,s]=r.useState(""),[c,m]=r.useState(1);r.useEffect(()=>{t.partNumber&&(n(!0),Ca(t.partNumber).then(y=>{x(y),n(!1)}).catch(()=>n(!1)))},[t]);const h=r.useMemo(()=>{if(!g.trim())return o;const y=g.toLowerCase();return o.filter(p=>{const{resi:z,subInfo:B,customer:M,keterangan:w}=$t(p);return w.toLowerCase().includes(y)||z.toLowerCase().includes(y)||B.toLowerCase().includes(y)||M.toLowerCase().includes(y)||p.reason.toLowerCase().includes(y)})},[o,g]),u=r.useMemo(()=>{const y=(c-1)*50;return h.slice(y,y+50)},[h,c]),i=Math.ceil(h.length/50)||1;return r.useEffect(()=>m(1),[g]),e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm animate-in fade-in",children:e.jsxs("div",{className:"bg-gray-800 rounded-2xl w-full max-w-5xl max-h-[85vh] flex flex-col border border-gray-700 shadow-2xl m-4 overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-gray-700 bg-gray-900/50 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-gray-100 flex items-center gap-2",children:[e.jsx(He,{size:16,className:"text-blue-400"})," Riwayat Item"]}),e.jsx("p",{className:"text-xs text-gray-400 truncate max-w-[300px]",children:t.name})]}),e.jsx("button",{onClick:a,className:"p-1 bg-gray-700 hover:bg-gray-600 rounded-full",children:e.jsx(Ne,{size:18})})]}),e.jsx("div",{className:"p-3 bg-gray-800 border-b border-gray-700",children:e.jsx("input",{type:"text",placeholder:"Cari Resi / Nama Customer...",className:"w-full bg-gray-900 border border-gray-700 rounded-lg px-3 py-2 text-xs text-gray-200 focus:border-blue-500 outline-none",value:g,onChange:y=>s(y.target.value)})}),e.jsx("div",{className:"flex-1 overflow-auto p-2 bg-gray-900/30",children:l?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(fe,{className:"animate-spin text-blue-500",size:24})}):u.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500 text-xs",children:"Belum ada riwayat transaksi."}):e.jsx(Ot,{data:u})}),e.jsxs("div",{className:"p-3 border-t border-gray-700 flex justify-between items-center bg-gray-800 rounded-b-2xl",children:[e.jsx("button",{onClick:()=>m(y=>Math.max(1,y-1)),disabled:c===1,className:"p-1 bg-gray-700 rounded disabled:opacity-30",children:e.jsx(De,{size:18})}),e.jsxs("span",{className:"text-xs text-gray-400",children:["Hal ",c," / ",i]}),e.jsx("button",{onClick:()=>m(y=>Math.min(i,y+1)),disabled:c===i,className:"p-1 bg-gray-700 rounded disabled:opacity-30",children:e.jsx(Ce,{size:18})})]})]})})},Qa=({history:t,refreshTrigger:a,onDelete:o})=>{const{selectedStore:x}=Oe(),[l,n]=r.useState([]),[g,s]=r.useState([]),[c,m]=r.useState(!1),[h,u]=r.useState(1),[i,y]=r.useState(1),[p,z]=r.useState(""),[B,M]=r.useState(""),[w,$]=r.useState(""),[E,_]=r.useState(""),[S,G]=r.useState(""),[J,ee]=r.useState(""),[ie,ne]=r.useState("all"),[Y,se]=r.useState("grid"),[q,te]=r.useState("none"),[re,xe]=r.useState({totalItems:0,totalStock:0,totalAsset:0,todayIn:0,todayOut:0}),[de,j]=r.useState(null),[N,f]=r.useState(null),[v,b]=r.useState(!1),[C,W]=r.useState(void 0);r.useEffect(()=>{const L=setTimeout(()=>{M(p),_(w),ee(S)},500);return()=>clearTimeout(L)},[p,w,S]),r.useEffect(()=>{u(1)},[B,ie,E,J,q]);const ae=r.useCallback(async()=>{if(m(!0),q!=="none"){const L=await va();s(L),y(Math.ceil(L.length/50))}else{const{data:L,count:X}=await ja();n(L),s([]),y(Math.ceil(X/50))}m(!1)},[h,B,ie,E,J,q,x]),me=r.useCallback(async()=>{const L=await Na(),X=new Date;X.setHours(0,0,0,0);const Q=t.filter(ce=>ce.type==="in"&&ce.timestamp&&ce.timestamp>=X.getTime()).reduce((ce,k)=>ce+(Number(k.quantity)||0),0),ve=t.filter(ce=>ce.type==="out"&&ce.timestamp&&ce.timestamp>=X.getTime()).reduce((ce,k)=>ce+(Number(k.quantity)||0),0);xe({...L,todayIn:Q,todayOut:ve})},[t,x]);r.useEffect(()=>{ae()},[ae,a]),r.useEffect(()=>{me()},[me,a]);const ue=r.useMemo(()=>{const L=q!=="none"?g:l;if(q==="none")return L;const X=[...L].sort((k,O)=>{const H=k.costPrice||k.price||0,R=O.costPrice||O.price||0;return q==="asc"?H-R:R-H}),Q=50,ve=(h-1)*Q,ce=ve+Q;return X.slice(ve,ce)},[l,g,q,h]),pe=L=>{W(L),b(!0)},ke=()=>{W(void 0),b(!0)},V=L=>{if(L){if(n(X=>X.map(Q=>Q.id===L.id?L:Q)),C){const X=L.quantity-C.quantity;xe(Q=>({...Q,totalStock:Q.totalStock+X}))}b(!1)}else b(!1),ae(),me()};return e.jsxs("div",{className:"bg-gray-900 min-h-screen pb-24 font-sans text-gray-100",children:[v&&e.jsx(Lt,{initialData:C,onCancel:()=>b(!1),onSuccess:V}),e.jsx(qa,{stats:re,onShowDetail:j}),e.jsx(_a,{searchTerm:p,setSearchTerm:z,brandSearch:w,setBrandSearch:$,appSearch:S,setAppSearch:G,filterType:ie,setFilterType:ne,viewMode:Y,setViewMode:se,priceSort:q,setPriceSort:te,onAddNew:ke}),e.jsx("div",{className:"p-4",children:e.jsx(Ua,{loading:c,items:ue,viewMode:Y,page:h,totalPages:i,setPage:u,onEdit:pe,onDelete:o,onShowHistory:f})}),de&&e.jsx(Ha,{type:de,onClose:()=>j(null)}),N&&e.jsx(Fa,{item:N,onClose:()=>f(null)})]})},Ka=({imageSrc:t,onConfirm:a,onCancel:o})=>{const[x,l]=r.useState(1),[n,g]=r.useState({x:0,y:0}),[s,c]=r.useState(!1),[m,h]=r.useState({x:0,y:0}),u=r.useRef(null),i=r.useRef(null),y=32/9,p=w=>{w.preventDefault(),c(!0);const $="touches"in w?w.touches[0].clientX:w.clientX,E="touches"in w?w.touches[0].clientY:w.clientY;h({x:$-n.x,y:E-n.y})},z=w=>{if(!s)return;w.preventDefault();const $="touches"in w?w.touches[0].clientX:w.clientX,E="touches"in w?w.touches[0].clientY:w.clientY;g({x:$-m.x,y:E-m.y})},B=()=>c(!1),M=()=>{const w=document.createElement("canvas"),$=w.getContext("2d"),E=u.current,_=i.current;if(!$||!E||!_)return;const S=1280,G=S/y;w.width=S,w.height=G;const J=_.getBoundingClientRect(),ee=E.getBoundingClientRect(),ie=S/J.width,ne=G/J.height,Y=(ee.left-J.left)*ie,se=(ee.top-J.top)*ne,q=ee.width*ie,te=ee.height*ne;$.fillStyle="#000000",$.fillRect(0,0,w.width,w.height),$.drawImage(E,Y,se,q,te);const re=w.toDataURL("image/jpeg",.9);a(re)};return e.jsxs("div",{className:"fixed inset-0 z-[80] bg-black/90 flex flex-col items-center justify-center p-4 animate-in fade-in",children:[e.jsxs("div",{className:"w-full max-w-3xl flex justify-between items-center text-white mb-4",children:[e.jsxs("h3",{className:"text-lg font-bold flex items-center gap-2",children:[e.jsx(Yt,{size:20})," Sesuaikan Posisi"]}),e.jsx("button",{onClick:o,className:"p-2 hover:bg-white/20 rounded-full",children:e.jsx(Ne,{size:24})})]}),e.jsxs("div",{ref:i,className:"relative w-full max-w-4xl bg-gray-800 overflow-hidden shadow-2xl border-2 border-white/20 cursor-move rounded-lg touch-none",style:{aspectRatio:`${y}`},onMouseDown:p,onMouseMove:z,onMouseUp:B,onMouseLeave:B,onTouchStart:p,onTouchMove:z,onTouchEnd:B,children:[e.jsx("img",{ref:u,src:t,alt:"Crop Target",draggable:!1,className:"absolute origin-center pointer-events-none transition-transform duration-75",style:{left:"50%",top:"50%",width:"100%",height:"auto",minHeight:"100%",transform:`translate(-50%, -50%) translate(${n.x}px, ${n.y}px) scale(${x})`}}),e.jsx("div",{className:"absolute inset-0 pointer-events-none opacity-30",children:e.jsxs("div",{className:"w-full h-full border border-white/50 flex",children:[e.jsx("div",{className:"flex-1 border-r border-white/30"}),e.jsx("div",{className:"flex-1 border-r border-white/30"}),e.jsx("div",{className:"flex-1"})]})})]}),e.jsxs("div",{className:"w-full max-w-md mt-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4 text-white",children:[e.jsx(Vt,{size:20}),e.jsx("input",{type:"range",min:"1",max:"3",step:"0.1",value:x,onChange:w=>l(parseFloat(w.target.value)),className:"flex-1 h-2 bg-gray-600 rounded-lg appearance-none cursor-pointer accent-blue-500"}),e.jsxs("span",{className:"text-xs font-mono w-8",children:[x.toFixed(1),"x"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("button",{onClick:o,className:"py-3 bg-gray-700 text-white rounded-xl font-bold hover:bg-gray-600",children:"Batal"}),e.jsxs("button",{onClick:M,className:"py-3 bg-blue-600 text-white rounded-xl font-bold hover:bg-blue-500 flex items-center justify-center gap-2",children:[e.jsx(Ee,{size:18})," Simpan & Upload"]})]}),e.jsx("p",{className:"text-center text-gray-400 text-xs",children:"Geser gambar untuk mengatur posisi. Gunakan slider untuk zoom."})]})]})},Ga=({searchTerm:t,setSearchTerm:a,partNumberSearch:o,setPartNumberSearch:x,nameSearch:l,setNameSearch:n,brandSearch:g,setBrandSearch:s,applicationSearch:c,setApplicationSearch:m,isAdmin:h,viewMode:u,setViewMode:i})=>e.jsxs("div",{className:"sticky top-0 z-30 bg-gray-900/95 backdrop-blur-sm pt-2 pb-2 -mx-2 px-2 md:mx-0 md:px-0 space-y-3 border-b border-gray-800",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative w-full group",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3.5 flex items-center pointer-events-none",children:e.jsx($e,{size:18,className:"text-gray-500 group-focus-within:text-blue-400 transition-colors"})}),e.jsx("input",{type:"text",placeholder:"Cari semua...",className:"pl-10 pr-4 py-3 w-full bg-gray-800 border border-gray-700 rounded-xl text-sm focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500 outline-none shadow-sm transition-all text-white placeholder-gray-500",value:t,onChange:y=>a(y.target.value)})]}),e.jsxs("div",{className:"bg-gray-800 rounded-xl p-1 flex shadow-sm border border-gray-700",children:[e.jsx("button",{onClick:()=>i("grid"),className:`p-2 rounded-lg transition-all ${u==="grid"?"bg-gray-700 text-blue-400 shadow-sm":"text-gray-500 hover:text-gray-300"}`,children:e.jsx(Ct,{size:18})}),e.jsx("button",{onClick:()=>i("list"),className:`p-2 rounded-lg transition-all ${u==="list"?"bg-gray-700 text-blue-400 shadow-sm":"text-gray-500 hover:text-gray-300"}`,children:e.jsx(Pt,{size:18})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(ye,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:14}),e.jsx("input",{type:"text",placeholder:"Part Number...",value:o,onChange:y=>x(y.target.value),className:"w-full pl-9 pr-3 py-2 bg-gray-700 border border-gray-600 rounded-xl text-xs font-medium focus:ring-2 focus:ring-blue-500/50 outline-none text-white placeholder-gray-500"})]}),e.jsxs("div",{className:"relative",children:[e.jsx($e,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:14}),e.jsx("input",{type:"text",placeholder:"Nama Barang...",value:l,onChange:y=>n(y.target.value),className:"w-full pl-9 pr-3 py-2 bg-gray-700 border border-gray-600 rounded-xl text-xs font-medium focus:ring-2 focus:ring-blue-500/50 outline-none text-white placeholder-gray-500"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(kt,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:14}),e.jsx("input",{type:"text",placeholder:"Brand...",value:g,onChange:y=>s(y.target.value),className:"w-full pl-9 pr-3 py-2 bg-gray-700 border border-gray-600 rounded-xl text-xs font-medium focus:ring-2 focus:ring-blue-500/50 outline-none text-white placeholder-gray-500"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(St,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:14}),e.jsx("input",{type:"text",placeholder:"Aplikasi...",value:c,onChange:y=>m(y.target.value),className:"w-full pl-9 pr-3 py-2 bg-gray-700 border border-gray-600 rounded-xl text-xs font-medium focus:ring-2 focus:ring-blue-500/50 outline-none text-white placeholder-gray-500"})]})]})]}),Ja=({items:t,shopItems:a,loading:o,viewMode:x="grid",onAddToCart:l})=>{const n=t||a||[],[g,s]=r.useState([]),[c,m]=r.useState(!1),h=(u,i)=>{u.stopPropagation();const y=i.images&&i.images.length>0?i.images:i.imageUrl?[i.imageUrl]:[];y.length>0&&(s(y),m(!0))};return o?e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-3",children:[...Array(10)].map((u,i)=>e.jsxs("div",{className:"bg-gray-800 rounded-2xl p-3 h-64 animate-pulse",children:[e.jsx("div",{className:"w-full aspect-square bg-gray-700 rounded-xl mb-3"}),e.jsx("div",{className:"h-4 bg-gray-700 rounded w-3/4 mb-2"}),e.jsx("div",{className:"h-3 bg-gray-700 rounded w-1/2"})]},i))}):!n||n.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-gray-500",children:[e.jsx(ye,{size:48,className:"mb-2 opacity-50"}),e.jsx("p",{children:"Barang tidak ditemukan"})]}):e.jsxs(e.Fragment,{children:[e.jsx(At,{isOpen:c,images:g,onClose:()=>m(!1)}),x==="grid"?e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-3",children:n.map(u=>e.jsxs("div",{className:"bg-gray-800 border border-gray-700 rounded-2xl overflow-hidden flex flex-col hover:border-gray-600 transition-all shadow-sm group",children:[e.jsxs("div",{className:"aspect-[4/3] relative bg-gray-700 cursor-pointer overflow-hidden",children:[u.imageUrl?e.jsx("img",{src:u.imageUrl,alt:u.name,className:"w-full h-full object-cover transition-transform duration-500 group-hover:scale-110 cursor-zoom-in",referrerPolicy:"no-referrer",onClick:i=>h(i,u),onError:i=>{i.target.style.display="none"}}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-600",children:e.jsx(ye,{size:24})}),e.jsx("div",{className:"absolute top-2 left-2 pointer-events-none",children:e.jsxs("span",{className:"text-[9px] font-bold px-1.5 py-0.5 rounded shadow-sm border bg-black/60 text-white backdrop-blur border-white/10",children:[u.quantity," Unit"]})}),u.images&&u.images.length>1&&e.jsxs("div",{className:"absolute bottom-2 left-2 bg-black/60 backdrop-blur text-white px-1.5 py-0.5 rounded text-[9px] flex items-center gap-1",children:[e.jsx(Le,{size:10})," ",u.images.length]})]}),e.jsxs("div",{className:"p-3 flex flex-col flex-1",children:[e.jsxs("div",{className:"mb-1",children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsx("span",{className:"text-[10px] md:text-xs font-bold text-gray-500 font-mono bg-gray-900 px-1 rounded border border-gray-800",children:u.partNumber}),u.brand&&e.jsx("span",{className:"text-[9px] md:text-[10px] bg-gray-700 text-gray-300 px-1 rounded border border-gray-600",children:u.brand})]}),e.jsx("h3",{className:"text-xs md:text-sm font-bold text-gray-200 line-clamp-2 leading-relaxed min-h-[2.5em]",title:u.name,children:u.name}),u.application&&e.jsx("div",{className:"mt-1",children:e.jsx("span",{className:"text-[9px] md:text-[10px] bg-blue-900/30 text-blue-300 px-1.5 py-0.5 rounded border border-blue-900/50 inline-block",children:u.application})})]}),e.jsxs("div",{className:"mt-auto pt-3 border-t border-gray-700 flex items-center justify-between",children:[e.jsx("div",{className:"text-sm md:text-base font-extrabold text-blue-400",children:Me(u.price)}),e.jsx("button",{onClick:()=>l(u),disabled:u.quantity===0,className:"w-8 h-8 flex items-center justify-center bg-blue-600 text-white rounded-lg hover:bg-blue-500 active:scale-95 transition-all disabled:bg-gray-700 disabled:text-gray-500 disabled:cursor-not-allowed shadow-lg shadow-blue-900/30",children:e.jsx(Ae,{size:16})})]})]})]},u.id))}):e.jsx("div",{className:"flex flex-col gap-3",children:n.map(u=>e.jsxs("div",{className:"bg-gray-800 border border-gray-700 rounded-xl p-3 flex items-center gap-3 hover:border-gray-600 transition-all shadow-sm",children:[e.jsxs("div",{className:"w-20 h-20 bg-gray-700 rounded-lg overflow-hidden flex-shrink-0 cursor-pointer relative group",children:[u.imageUrl?e.jsx("img",{src:u.imageUrl,alt:u.name,className:"w-full h-full object-cover transition-transform duration-300 group-hover:scale-110 cursor-zoom-in",referrerPolicy:"no-referrer",onClick:i=>h(i,u),onError:i=>{i.target.style.display="none"}}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-600",children:e.jsx(ye,{size:20})}),u.images&&u.images.length>1&&e.jsxs("div",{className:"absolute bottom-1 right-1 bg-black/70 text-white text-[8px] px-1 rounded flex items-center gap-0.5",children:[e.jsx(Le,{size:8})," ",u.images.length]})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-[10px] md:text-xs font-bold text-gray-500 font-mono bg-gray-900 px-1.5 py-0.5 rounded border border-gray-800",children:u.partNumber}),e.jsxs("span",{className:"text-[9px] md:text-[10px] font-bold px-1.5 py-0.5 rounded bg-black/60 text-white border border-white/10",children:[u.quantity," Unit"]})]}),e.jsx("h3",{className:"text-sm md:text-base font-bold text-gray-200 truncate mb-1",title:u.name,children:u.name}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[u.brand&&e.jsx("span",{className:"text-[9px] md:text-[10px] bg-gray-700 text-gray-300 px-1.5 py-0.5 rounded border border-gray-600 inline-block",children:u.brand}),u.application&&e.jsx("span",{className:"text-[9px] md:text-[10px] bg-blue-900/30 text-blue-300 px-1.5 py-0.5 rounded border border-blue-900/50 inline-block",children:u.application})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2 pl-2",children:[e.jsx("div",{className:"text-base md:text-lg font-extrabold text-blue-400",children:Me(u.price)}),e.jsxs("button",{onClick:()=>l(u),disabled:u.quantity===0,className:"px-4 py-2 flex items-center gap-2 bg-blue-600 text-white rounded-lg hover:bg-blue-500 active:scale-95 transition-all disabled:bg-gray-700 disabled:text-gray-500 disabled:cursor-not-allowed shadow-lg shadow-blue-900/30 text-xs font-bold",children:[e.jsx(Ae,{size:14}),"Beli"]})]})]},u.id))})]})},Wa=({page:t,totalPages:a,setPage:o})=>e.jsxs("div",{className:"flex justify-between items-center mt-8 bg-gray-800/90 backdrop-blur p-3 rounded-xl border border-gray-700 shadow-sm sticky bottom-20 md:bottom-4 z-20",children:[e.jsxs("button",{onClick:()=>o(x=>Math.max(1,x-1)),disabled:t===1,className:"flex items-center gap-1 text-xs font-bold px-4 py-2 rounded-lg hover:bg-gray-700 text-gray-300 disabled:opacity-30 disabled:cursor-not-allowed",children:[e.jsx(De,{size:16})," Sebelumnya"]}),e.jsxs("span",{className:"text-xs font-medium text-gray-500",children:["Halaman ",e.jsx("span",{className:"font-bold text-gray-200",children:t})," dari ",a||1]}),e.jsxs("button",{onClick:()=>o(x=>Math.min(a,x+1)),disabled:t===a||a===0,className:"flex items-center gap-1 text-xs font-bold px-4 py-2 rounded-lg hover:bg-gray-700 text-gray-300 disabled:opacity-30 disabled:cursor-not-allowed",children:["Selanjutnya ",e.jsx(Ce,{size:16})]})]}),Ya=({isOpen:t,onClose:a,cart:o,onRemoveFromCart:x,onUpdateCartItem:l,onCheckoutClick:n})=>{if(!t)return null;const g=o.reduce((s,c)=>s+(c.customPrice??c.price)*c.cartQuantity,0);return e.jsxs("div",{className:"fixed inset-0 z-[60] flex justify-end",children:[e.jsx("div",{className:"absolute inset-0 bg-black/70 backdrop-blur-sm",onClick:a}),e.jsxs("div",{className:"relative w-full max-w-md bg-gray-800 h-full shadow-2xl flex flex-col animate-in slide-in-from-right border-l border-gray-700",children:[e.jsxs("div",{className:"px-5 py-4 border-b border-gray-700 flex justify-between items-center bg-gray-800",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-100",children:"Keranjang"}),e.jsx("button",{onClick:a,className:"text-gray-400 hover:text-white",children:e.jsx(Ne,{size:20})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 bg-gray-900",children:[o.map(s=>e.jsxs("div",{className:"bg-gray-800 p-3 rounded-xl shadow-sm border border-gray-700 relative group",children:[e.jsx("button",{onClick:()=>x(s.id),className:"absolute top-2 right-2 text-gray-600 hover:text-red-500 transition-colors",children:e.jsx(Ne,{size:16})}),e.jsxs("div",{className:"flex gap-3 mb-3",children:[e.jsx("div",{className:"w-14 h-14 bg-gray-700 rounded-lg overflow-hidden flex-shrink-0",children:s.imageUrl?e.jsx("img",{src:s.imageUrl,className:"w-full h-full object-cover",referrerPolicy:"no-referrer"}):e.jsx("div",{className:"h-full flex items-center justify-center text-gray-500",children:e.jsx(ye,{size:16})})}),e.jsxs("div",{className:"flex-1 pr-4",children:[e.jsx("h4",{className:"text-sm font-bold line-clamp-2 leading-snug text-gray-200",children:s.name}),e.jsx("p",{className:"text-[10px] text-gray-500 font-mono mt-0.5",children:s.partNumber})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-gray-700 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>l(s.id,{cartQuantity:Math.max(1,s.cartQuantity-1)}),className:"w-6 h-6 flex items-center justify-center bg-gray-600 rounded text-gray-300 shadow-sm hover:bg-gray-500 active:scale-95",children:e.jsx(Xt,{size:12})}),e.jsx("span",{className:"text-xs font-bold w-4 text-center text-gray-200",children:s.cartQuantity}),e.jsx("button",{onClick:()=>l(s.id,{cartQuantity:s.cartQuantity+1}),className:"w-6 h-6 flex items-center justify-center bg-gray-600 rounded text-gray-300 shadow-sm hover:bg-gray-500 active:scale-95",children:e.jsx(Te,{size:12})})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-2 top-1/2 -translate-y-1/2 text-[10px] text-blue-300 font-bold",children:"Rp"}),e.jsx("input",{type:"number",className:"w-24 pl-6 pr-2 py-1 text-right text-xs font-bold border border-blue-900 rounded focus:ring-2 focus:ring-blue-500 outline-none bg-blue-900/20 text-blue-200 placeholder-blue-500/50",placeholder:s.price.toString(),value:s.customPrice??"",onChange:c=>l(s.id,{customPrice:c.target.value?Number(c.target.value):void 0})})]}),e.jsx("span",{className:"text-[9px] text-gray-500 mt-0.5",children:"Harga Tawar"}),s.customPrice&&e.jsx("span",{className:"text-[9px] text-gray-600 line-through mr-1",children:ge(s.price)})]})})]})]},s.id)),o.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-gray-500",children:[e.jsx(Ae,{size:48,className:"mb-2 opacity-20"}),e.jsx("p",{children:"Keranjang kosong"})]})]}),e.jsxs("div",{className:"p-5 border-t border-gray-700 bg-gray-800 safe-area-bottom",children:[e.jsxs("div",{className:"flex justify-between mb-4",children:[e.jsx("span",{className:"font-bold text-gray-400",children:"Total"}),e.jsx("span",{className:"font-extrabold text-xl text-gray-100",children:ge(g)})]}),e.jsx("button",{onClick:n,disabled:o.length===0,className:"w-full bg-gray-100 text-gray-900 py-3.5 rounded-xl font-bold hover:bg-white disabled:opacity-50",children:"Lanjut Bayar"})]})]})]})},Va=({isOpen:t,onClose:a,onConfirm:o})=>{const[x,l]=r.useState(""),[n,g]=r.useState(""),[s,c]=r.useState("");if(!t)return null;const m=h=>{if(h.preventDefault(),x.trim()){let u=x;n.trim()&&(u+=` (Tempo: ${n})`),s.trim()&&(u+=` (Note: ${s})`),o(u,n,s),l(""),g(""),c("")}};return e.jsxs("div",{className:"fixed inset-0 z-[70] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/70 backdrop-blur-sm",onClick:a}),e.jsxs("div",{className:"bg-gray-800 rounded-3xl shadow-2xl w-full max-w-sm relative overflow-hidden animate-in zoom-in-95 border border-gray-700",children:[e.jsx("div",{className:"bg-gray-900 px-6 py-4 border-b border-gray-700",children:e.jsx("h3",{className:"text-lg font-bold text-gray-100",children:"Konfirmasi Pesanan"})}),e.jsxs("form",{onSubmit:m,className:"p-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase",children:"Nama Customer"}),e.jsx("input",{type:"text",required:!0,autoFocus:!0,value:x,onChange:h=>l(h.target.value),className:"w-full p-3 border border-gray-600 bg-gray-700 rounded-xl mt-1 text-white placeholder-gray-500 outline-none focus:border-blue-500",placeholder:"Nama customer..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase",children:"Tempo"}),e.jsx("input",{type:"text",value:n,onChange:h=>g(h.target.value),className:"w-full p-3 border border-gray-600 bg-gray-700 rounded-xl mt-1 text-white placeholder-gray-500 outline-none focus:border-blue-500",placeholder:"Contoh: 7 hari, 14 hari..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase",children:"Note"}),e.jsx("textarea",{value:s,onChange:h=>c(h.target.value),className:"w-full p-3 border border-gray-600 bg-gray-700 rounded-xl mt-1 text-white placeholder-gray-500 outline-none focus:border-blue-500 resize-none",placeholder:"Catatan tambahan...",rows:3})]})]}),e.jsxs("div",{className:"mt-6 grid grid-cols-2 gap-3",children:[e.jsx("button",{type:"button",onClick:a,className:"py-3 bg-gray-700 text-gray-300 font-bold rounded-xl hover:bg-gray-600",children:"Batal"}),e.jsx("button",{type:"submit",disabled:!x.trim(),className:"py-3 bg-blue-600 text-white font-bold rounded-xl hover:bg-blue-700 disabled:opacity-50",children:"Kirim"})]})]})]})]})},Xa=({isOpen:t,onClose:a,cart:o,customerName:x,tempo:l,note:n})=>{const g=r.useRef(null);if(!t)return null;const s=o.reduce((i,y)=>i+(y.customPrice??y.price)*y.cartQuantity,0),c=new Date().toLocaleDateString("id-ID",{day:"2-digit",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"}),m=async()=>{if(!g.current)return null;try{return(await Ut(g.current,{backgroundColor:"#ffffff",scale:2,logging:!1})).toDataURL("image/jpeg",.95)}catch(i){return console.error("Error generating receipt image:",i),null}},h=()=>{const i=window.open("","_blank","width=800,height=600");if(!i||!g.current)return;const y=g.current.innerHTML;i.document.write(`
            <!DOCTYPE html>
            <html>
            <head>
                <title>BJWAutopart - Resi ${x}</title>
                <style>
                    body {
                        font-family: Arial, sans-serif;
                        margin: 20px;
                        background: white;
                    }
                    @media print {
                        body { margin: 0; }
                    }
                </style>
            </head>
            <body>
                ${y}
                <script>
                    window.onload = function() {
                        window.print();
                        // Optionally close after printing
                        // window.onafterprint = function() { window.close(); };
                    };
                <\/script>
            </body>
            </html>
        `),i.document.close()},u=async()=>{var B;const i=await m();if(!i)return;const p=await(await fetch(i)).blob(),z=new File([p],`BJWAutopart-${x}.jpg`,{type:"image/jpeg"});if(navigator.share&&((B=navigator.canShare)!=null&&B.call(navigator,{files:[z]})))try{await navigator.share({files:[z],title:"BJWAutopart - Resi Pesanan",text:`Resi pesanan BJWAutopart untuk ${x}`})}catch(M){console.log("Share cancelled or failed:",M)}else{const M=encodeURIComponent(`BJWAutopart - Resi Pesanan
Customer: ${x}
Total: ${ge(s)}`);window.open(`https://wa.me/?text=${M}`,"_blank")}};return e.jsxs("div",{className:"fixed inset-0 z-[80] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/70 backdrop-blur-sm",onClick:a}),e.jsxs("div",{className:"bg-gray-800 rounded-3xl shadow-2xl w-full max-w-md relative overflow-hidden animate-in zoom-in-95 border border-gray-700 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"bg-gray-900 px-6 py-4 border-b border-gray-700 flex justify-between items-center sticky top-0 z-10",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-100",children:"BJWAutopart - Resi Pesanan"}),e.jsx("button",{onClick:a,className:"text-gray-400 hover:text-white",children:e.jsx(Ne,{size:20})})]}),e.jsxs("div",{ref:g,className:"bg-white p-6",children:[e.jsxs("div",{className:"text-center mb-4 border-b-2 border-gray-800 pb-3",children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900 mb-0.5",children:"BJWAutopart"}),e.jsx("p",{className:"text-xs text-gray-600",children:c})]}),e.jsxs("div",{className:"mb-4 bg-gray-50 p-3 rounded",children:[e.jsxs("div",{className:"flex justify-between gap-4 text-xs",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-gray-600 font-semibold mb-0.5",children:"Customer:"}),e.jsx("p",{className:"text-gray-900 font-bold",children:x})]}),l&&e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-gray-600 font-semibold mb-0.5",children:"Tempo:"}),e.jsx("p",{className:"text-gray-900 font-bold",children:l})]})]}),n&&e.jsxs("div",{className:"mt-2 pt-2 border-t border-gray-300",children:[e.jsx("p",{className:"text-gray-600 font-semibold text-xs mb-0.5",children:"Note:"}),e.jsx("p",{className:"text-gray-900 text-xs",children:n})]})]}),e.jsx("div",{className:"mb-4",children:e.jsxs("table",{className:"w-full text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b-2 border-gray-800",children:[e.jsx("th",{className:"text-left py-1.5 font-bold text-gray-900 w-16",children:"Part#"}),e.jsx("th",{className:"text-left py-1.5 font-bold text-gray-900",children:"Keterangan"}),e.jsx("th",{className:"text-center py-1.5 font-bold text-gray-900 w-10",children:"Qty"}),e.jsx("th",{className:"text-right py-1.5 font-bold text-gray-900 w-20",children:"Harga"}),e.jsx("th",{className:"text-right py-1.5 font-bold text-gray-900 w-20",children:"Total"})]})}),e.jsx("tbody",{children:o.map((i,y)=>{const p=i.customPrice??i.price,z=p*i.cartQuantity;return e.jsxs("tr",{className:"border-b border-gray-300",children:[e.jsx("td",{className:"py-2 align-top",children:e.jsx("p",{className:"text-gray-900 font-mono text-[10px] leading-tight",children:i.partNumber})}),e.jsxs("td",{className:"py-2 align-top",children:[e.jsx("p",{className:"font-semibold text-gray-900 leading-tight",children:i.name}),i.brand&&e.jsxs("p",{className:"text-[10px] text-gray-600 leading-tight",children:["Brand: ",i.brand]}),i.application&&e.jsxs("p",{className:"text-[10px] text-gray-600 leading-tight",children:["Aplikasi: ",i.application]})]}),e.jsx("td",{className:"text-center font-bold text-gray-900 align-top py-2",children:i.cartQuantity}),e.jsx("td",{className:"text-right text-gray-900 align-top py-2",children:ge(p)}),e.jsx("td",{className:"text-right font-bold text-gray-900 align-top py-2",children:ge(z)})]},i.id)})})]})}),e.jsx("div",{className:"border-t-2 border-gray-800 pt-3",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-base font-bold text-gray-900",children:"TOTAL:"}),e.jsx("span",{className:"text-lg font-bold text-gray-900",children:ge(s)})]})}),e.jsx("div",{className:"mt-4 text-center text-[10px] text-gray-600 border-t border-gray-300 pt-3",children:e.jsx("p",{children:"Terima kasih atas pesanan Anda"})})]}),e.jsxs("div",{className:"p-6 bg-gray-900 border-t border-gray-700 grid grid-cols-2 gap-3",children:[e.jsxs("button",{onClick:h,className:"py-3 px-4 bg-gray-700 text-gray-100 font-bold rounded-xl hover:bg-gray-600 flex items-center justify-center gap-2",children:[e.jsx(Zt,{size:18}),"Cetak"]}),e.jsxs("button",{onClick:u,className:"py-3 px-4 bg-green-600 text-white font-bold rounded-xl hover:bg-green-700 flex items-center justify-center gap-2",children:[e.jsx(ea,{size:18}),"Share WhatsApp"]})]})]})]})},Za=({cart:t=[],isAdmin:a,isKingFano:o,bannerUrl:x,onAddToCart:l,onRemoveFromCart:n,onUpdateCartItem:g,onCheckout:s,onUpdateBanner:c})=>{const{selectedStore:m}=Oe(),[h,u]=r.useState([]),[i,y]=r.useState(!1),[p,z]=r.useState(""),[B,M]=r.useState(""),[w,$]=r.useState(""),[E,_]=r.useState(""),[S,G]=r.useState(""),[J,ee]=r.useState(""),[ie,ne]=r.useState(""),[Y,se]=r.useState(""),[q,te]=r.useState(""),[re,xe]=r.useState(""),[de,j]=r.useState(1),[N,f]=r.useState(1),[v,b]=r.useState("grid"),[C,W]=r.useState("All"),[ae,me]=r.useState(!1),[ue,pe]=r.useState(!1),[ke,V]=r.useState(!1),[L,X]=r.useState(null),[Q,ve]=r.useState(!1),[ce,k]=r.useState(null);r.useRef(null);const O=t.reduce((be,F)=>be+F.cartQuantity,0),H=50;r.useEffect(()=>{const be=setTimeout(()=>{j(1),M(p),_(w),ee(S),se(ie),xe(q)},500);return()=>clearTimeout(be)},[p,w,S,ie,q]),r.useEffect(()=>{(async()=>{y(!0);try{const F=C==="Semua"?"All":C,{data:U,count:Z}=await Ra(de,H,B,F,E,J,Y,re,m);u(U||[]);const he=Z||0;f(he>0?Math.ceil(he/H):1)}catch(F){console.error("Gagal load shop items:",F),u([])}finally{y(!1)}})()},[de,B,C,E,J,Y,re,m]);const R=async be=>{k(null),ve(!0);try{const F=await nt(be,1280,.9);await c(F)}catch(F){console.error("Gagal upload banner",F),alert("Gagal memproses gambar banner")}finally{ve(!1)}},oe=(be,F,U)=>{const Z=be.split(" (")[0];X({customerName:Z,tempo:F,note:U}),X({customerName:Z,tempo:F,note:U,finalName:be}),pe(!1),V(!0)},we=()=>{L!=null&&L.finalName&&s(L.finalName),V(!1)};return e.jsxs("div",{className:"relative min-h-full pb-20 bg-gray-900 text-gray-100 flex flex-col h-full overflow-hidden",children:[ce&&e.jsx(Ka,{imageSrc:ce,onConfirm:R,onCancel:()=>k(null)}),e.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar",children:[e.jsx("div",{className:"sticky top-0 z-10 bg-gray-900 px-4 py-2 border-b border-gray-800 shadow-md",children:e.jsx(Ga,{searchTerm:p,setSearchTerm:z,partNumberSearch:w,setPartNumberSearch:$,nameSearch:S,setNameSearch:G,brandSearch:ie,setBrandSearch:ne,applicationSearch:q,setApplicationSearch:te,isAdmin:a,viewMode:v,setViewMode:b})}),e.jsxs("div",{className:"p-4 pb-24",children:[e.jsx(Ja,{loading:i,items:h,shopItems:h,viewMode:v,isAdmin:a,isKingFano:o,adminPriceMode:"retail",onAddToCart:l}),!i&&h.length>0&&e.jsx("div",{className:"mt-8 flex justify-center",children:e.jsx(Wa,{page:de,totalPages:N,setPage:j})})]})]}),e.jsxs("button",{onClick:()=>me(!0),className:"fixed bottom-6 right-6 sm:bottom-8 sm:right-8 bg-blue-600 text-white p-4 rounded-full shadow-2xl hover:bg-blue-500 hover:scale-105 active:scale-95 transition-all z-40 flex items-center justify-center group border-2 border-blue-400",children:[e.jsx(Ae,{size:24}),O>0&&e.jsx("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-[10px] font-bold w-6 h-6 rounded-full flex items-center justify-center border-2 border-gray-900 shadow-sm",children:O})]}),e.jsx(Ya,{isOpen:ae,onClose:()=>me(!1),cart:t,onRemoveFromCart:n,onUpdateCartItem:g,onCheckoutClick:()=>{me(!1),pe(!0)}}),e.jsx(Va,{isOpen:ue,onClose:()=>pe(!1),onConfirm:oe}),e.jsx(Xa,{isOpen:ke,onClose:we,cart:t,customerName:(L==null?void 0:L.customerName)||"",tempo:(L==null?void 0:L.tempo)||"",note:(L==null?void 0:L.note)||""})]})},es=({isOpen:t,noteText:a,setNoteText:o,onClose:x,onSave:l,isSaving:n})=>t?e.jsx("div",{className:"absolute inset-0 z-[60] flex items-center justify-center bg-black/70 backdrop-blur-sm p-4 animate-in fade-in",children:e.jsxs("div",{className:"bg-gray-800 rounded-2xl shadow-2xl w-full max-w-md overflow-hidden flex flex-col border border-gray-700",children:[e.jsxs("div",{className:"bg-purple-900/30 px-4 py-3 border-b border-purple-800 flex justify-between items-center",children:[e.jsxs("h3",{className:"text-base font-bold text-purple-300 flex items-center gap-2",children:[e.jsx(ta,{size:18})," Edit Keterangan"]}),e.jsx("button",{onClick:x,children:e.jsx(Ne,{size:18,className:"text-gray-400 hover:text-gray-200"})})]}),e.jsx("div",{className:"p-4",children:e.jsx("textarea",{className:"w-full p-3 bg-gray-900 border border-gray-700 rounded-xl focus:ring-2 focus:ring-purple-900/50 outline-none text-sm min-h-[100px] text-gray-100 placeholder-gray-500",placeholder:"Masukkan alasan atau catatan...",value:a,onChange:g=>o(g.target.value)})}),e.jsxs("div",{className:"p-3 border-t border-gray-700 bg-gray-900/50 flex justify-end gap-2",children:[e.jsx("button",{onClick:x,className:"px-3 py-1.5 text-xs font-bold text-gray-400 hover:bg-gray-700 rounded-lg",children:"Batal"}),e.jsxs("button",{onClick:l,disabled:n,className:"px-4 py-1.5 text-xs font-bold bg-purple-600 text-white hover:bg-purple-700 rounded-lg shadow flex items-center gap-2",children:[n?e.jsx(It,{size:14,className:"animate-spin"}):e.jsx(Fe,{size:14})," Simpan"]})]})]})}):null,ts=({isOpen:t,order:a,returnQuantities:o,setReturnQuantities:x,onClose:l,onProcess:n,isProcessing:g})=>!t||!a?null:e.jsx("div",{className:"absolute inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm p-4 animate-in fade-in",children:e.jsxs("div",{className:"bg-gray-800 rounded-2xl shadow-2xl w-full max-w-lg overflow-hidden flex flex-col max-h-[90%] border border-gray-700",children:[e.jsxs("div",{className:"bg-orange-900/30 px-4 py-3 border-b border-orange-800 flex justify-between items-center",children:[e.jsxs("h3",{className:"text-base font-bold text-orange-300 flex items-center gap-2",children:[e.jsx(aa,{size:18})," Retur Barang"]}),e.jsx("button",{onClick:l,children:e.jsx(Ne,{size:18,className:"text-orange-400 hover:text-orange-200"})})]}),e.jsx("div",{className:"p-4 overflow-y-auto text-sm",children:e.jsx("div",{className:"space-y-2",children:a.items.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-2 border border-gray-700 rounded-lg hover:border-orange-700/50",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-bold text-gray-200 text-xs",children:s.name}),e.jsx("div",{className:"text-[10px] text-gray-500 font-mono",children:s.partNumber})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-gray-900 p-1 rounded-lg border border-gray-700",children:[e.jsx("button",{onClick:()=>x(c=>({...c,[s.id]:Math.max(0,(c[s.id]||0)-1)})),className:"w-6 h-6 flex items-center justify-center bg-gray-700 rounded shadow-sm hover:bg-red-900/50 text-gray-300 font-bold",children:"-"}),e.jsx("div",{className:"w-6 text-center font-bold text-sm text-gray-200",children:o[s.id]||0}),e.jsx("button",{onClick:()=>x(c=>({...c,[s.id]:Math.min(s.cartQuantity||0,(c[s.id]||0)+1)})),className:"w-6 h-6 flex items-center justify-center bg-gray-700 rounded shadow-sm hover:bg-green-900/50 text-gray-300 font-bold",children:"+"})]})]},s.id))})}),e.jsxs("div",{className:"p-3 border-t border-gray-700 bg-gray-900/50 flex justify-end gap-2",children:[e.jsx("button",{onClick:l,className:"px-3 py-1.5 text-xs font-bold text-gray-400 hover:bg-gray-700 rounded-lg",children:"Batal"}),e.jsxs("button",{onClick:n,disabled:g,className:"px-4 py-1.5 text-xs font-bold bg-orange-600 text-white hover:bg-orange-700 rounded-lg shadow flex items-center gap-2",children:[g?e.jsx(It,{size:14,className:"animate-spin"}):e.jsx(Fe,{size:14})," Proses"]})]})]})}),as=async t=>(console.log("Mock: analyzeResiImage called"),Promise.resolve({date:new Date().toISOString(),resi:"RESI-SAMPLE-001",ecommerce:"Sample",customerName:"Sample Customer",items:[]})),pt=["MJM","LARIS","BJW"],ss=["Shopee","Tiktok","Tokopedia","Lazada","Offline"],rs=({onShowToast:t,onRefreshParent:a,searchTerm:o})=>{const{selectedStore:x}=Oe(),[l,n]=r.useState([]),[g,s]=r.useState([]),[c,m]=r.useState(""),[h,u]=r.useState(pt[0]),[i,y]=r.useState("Shopee"),[p,z]=r.useState(!1),[B,M]=r.useState([]),[w,$]=r.useState(!1),[E,_]=r.useState(!1),[S,G]=r.useState(!1),[J,ee]=r.useState(!1),[ie,ne]=r.useState(null),[Y,se]=r.useState(1),q=100,[te,re]=r.useState([]),[xe,de]=r.useState(null),[j,N]=r.useState(-1),[f,v]=r.useState(null),b=r.useRef(null),C=r.useRef(null),W=r.useRef(null),ae=r.useRef([]),me=r.useRef(null);r.useEffect(()=>{ue(),B.length===0&&Mt().then(M),setTimeout(()=>{var d;(d=b.current)==null||d.focus()},100)},[]),r.useEffect(()=>{const d=l.filter(P=>P.status==="Siap Kirim").map(P=>P.resi);s(d)},[l]),r.useEffect(()=>se(1),[o]),r.useEffect(()=>{j>=0&&me.current&&me.current.scrollIntoView({block:"nearest",behavior:"smooth"})},[j]);const ue=async()=>{n(await Ma())},pe=(d,P,T)=>{const I=T.replace(/[^0-9]/g,""),A=I===""?0:parseInt(I,10);n(K=>K.map(le=>le.id===d?{...le,[P]:A}:le))},ke=d=>!!d.part_number&&d.part_number!=="-"&&d.part_number.trim()!==""&&!!d.nama_barang&&d.nama_barang!=="-"&&(d.quantity||0)>0&&!!d.customer&&d.customer!=="-",V=(d,P,T=5)=>{if(d.ctrlKey||d.altKey||d.metaKey)return;let I=P;switch(d.key){case"ArrowRight":I=P+1;break;case"ArrowLeft":I=P-1;break;case"ArrowUp":d.preventDefault(),I=P-T;break;case"ArrowDown":d.preventDefault(),I=P+T;break;case"Enter":d.preventDefault(),I=P+1;break;default:return}const A=ae.current[I];A&&(A.focus(),"select"in A&&setTimeout(()=>A.select(),0))},L=(d,P,T)=>{if(te.length>0&&xe===P){if(d.key==="ArrowDown"){d.preventDefault(),N(I=>I<te.length-1?I+1:0);return}else if(d.key==="ArrowUp"){d.preventDefault(),N(I=>I>0?I-1:te.length-1);return}else if(d.key==="Enter"){if(j>=0&&te[j]){d.preventDefault(),R(P,te[j]);return}}else if(d.key==="Escape"){de(null),re([]);return}}V(d,T)},X=async d=>{if(d.key==="Enter"){d.preventDefault();const P=c.trim();if(!P)return;$(!0);const T=l.find(I=>I.resi===P);T?(ke(T)?T.status!=="Siap Kirim"?(await Re(T.id),n(A=>A.map(K=>K.id===T.id?{...K,status:"Siap Kirim"}:K)),t(`Resi ${P} OK -> Siap Kirim`,"success")):t(`Resi ${P} sudah Siap Kirim`,"info"):(T.status!=="Pending"&&(await Re(T.id),n(A=>A.map(K=>K.id===T.id?{...K,status:"Pending"}:K))),t(`Resi ${P} Data Masih Kurang!`,"error")),await ut()):await ut()?(await ue(),t(`Resi ${P} Baru (Pending).`,"success")):t("Gagal menyimpan data.","error"),m(""),$(!1)}},Q=async(d,P,T)=>{try{const I=l.find(K=>K.id===d);if(!I)return;let A={...I,[P]:T};if(P==="quantity"){const K=parseFloat(T)||0,le=I.harga_satuan*K;A={...A,quantity:K,harga_total:le},n(D=>D.map(Se=>Se.id===d?A:Se)),await Re(d,"quantity",K),await Re(d,"harga_total",le)}else if(P==="harga_total"){const K=parseFloat(T)||0,le=A.quantity>0?K/A.quantity:0;A={...A,harga_total:K,harga_satuan:le},n(D=>D.map(Se=>Se.id===d?A:Se)),await Re(d,"harga_total",K),await Re(d,"harga_satuan",le)}else n(K=>K.map(le=>le.id===d?A:le)),await Re(d,P,T)}catch{t(`Gagal update ${P}`,"error"),ue()}},ve=async()=>{if(g.length===0)return;const P=l.filter(I=>g.includes(I.resi)).find(I=>!I.part_number||I.part_number.trim()===""||I.part_number==="-");if(P){t(`Gagal: Resi ${P.resi} belum ada Part Number!`,"error");return}ee(!0);const T=await Da();T.success?(t("Berhasil diproses! Stok terupdate.","success"),await ue(),s([]),a()):t(T.message||"Terjadi kesalahan.","error"),ee(!1)},ce=async d=>{ne(d),await Ba()?(t("Duplikasi Berhasil","success"),await ue()):t("Gagal duplikasi","error"),ne(null)},k=async d=>{window.confirm("Hapus item ini?")&&(await La()?(t("Item dihapus.","success"),await ue()):t("Gagal menghapus.","error"))},O=(d,P,T)=>{if(de(d),N(-1),T){const I=T.getBoundingClientRect(),A=window.innerHeight-I.bottom;let K={left:I.left,width:Math.max(I.width,250)};A<220&&I.top>220?K.bottom=window.innerHeight-I.top:K.top=I.bottom,v(K)}if(P&&P.length>=2){const I=P.toLowerCase(),A=B.filter(K=>K.partNumber&&K.partNumber.toLowerCase().includes(I)).slice(0,10);re(A)}else re([])},H=(d,P,T)=>{n(I=>I.map(A=>A.id===d?{...A,part_number:P}:A)),O(d,P,T.target)},R=async(d,P)=>{n(I=>I.map(A=>A.id===d?{...A,part_number:P.partNumber}:A)),await Q(d,"part_number",P.partNumber),de(null),re([]);const T=l.slice((Y-1)*q,Y*q).findIndex(I=>I.id===d);if(T!==-1){const I=T*5+2;setTimeout(()=>{var A;return(A=ae.current[I])==null?void 0:A.focus()},50)}},oe=d=>new Promise((P,T)=>{const I=new FileReader;I.onload=()=>P(I.result),I.onerror=T,I.readAsDataURL(d)}),we=async d=>{var T;const P=(T=d.target.files)==null?void 0:T[0];if(P){G(!0);try{const I=await nt(await oe(P)),A=await as(I);A&&A.resi?(m(A.resi),X({key:"Enter",preventDefault:()=>{}})):t("Resi tidak terbaca.","error")}catch(I){console.error(I)}finally{G(!1),C.current&&(C.current.value="")}}},be=async d=>{var T;(T=d.target.files)!=null&&T[0]&&(_(!0),t("Excel import tidak tersedia di versi statis","error"),_(!1),W.current&&(W.current.value=""))},F=d=>s(P=>P.includes(d)?P.filter(T=>T!==d):[...P,d]),U=d=>{switch(d){case"Shopee":return"bg-orange-900/30 text-orange-300 border-orange-800";case"Tokopedia":return"bg-green-900/30 text-green-300 border-green-800";case"Tiktok":return"bg-gray-700 text-white border-gray-600";default:return"bg-gray-700 text-gray-300 border-gray-600"}},Z=r.useMemo(()=>l?l.filter(d=>!o||d.resi.toLowerCase().includes(o.toLowerCase())||d.customer&&d.customer.toLowerCase().includes(o.toLowerCase())||d.nama_barang&&d.nama_barang.toLowerCase().includes(o.toLowerCase())):[],[l,o]);Z.length;const he=(Y-1)*q,je=Z.slice(he,he+q),_e=g.length;return e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden bg-gray-900",children:[e.jsx("div",{className:"bg-gray-800 p-3 shadow-sm border-b border-gray-700 z-20",children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("select",{value:h,onChange:d=>{var P;u(d.target.value),(P=b.current)==null||P.focus()},className:"bg-gray-700 border border-gray-600 text-gray-200 text-xs font-bold rounded-lg focus:ring-blue-500 focus:border-blue-500 p-2 outline-none",children:pt.map(d=>e.jsx("option",{value:d,children:d},d))}),e.jsxs("div",{className:"relative flex",children:[e.jsxs("button",{onClick:()=>z(!p),className:`flex items-center justify-between w-full gap-2 px-2 py-2 text-xs font-bold border rounded-lg transition-colors ${U(i)}`,children:[e.jsx("span",{className:"truncate",children:i}),e.jsx(sa,{className:"w-3 h-3 text-gray-300 flex-shrink-0"})]}),p&&e.jsx("div",{className:"absolute top-full right-0 mt-1 w-40 bg-gray-800 rounded-xl shadow-xl border border-gray-700 z-50 animate-in fade-in zoom-in-95 overflow-hidden",children:ss.map(d=>e.jsxs("button",{onClick:()=>{var P;y(d),z(!1),(P=b.current)==null||P.focus()},className:`w-full text-left px-3 py-2 text-xs flex items-center justify-between hover:bg-gray-700 border-b border-gray-700 last:border-0 ${i===d?"text-blue-400 font-bold bg-blue-900/20":"text-gray-300"}`,children:[d,i===d&&e.jsx(Ee,{className:"w-3 h-3"})]},d))})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-grow",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none",children:w?e.jsx(fe,{className:"w-4 h-4 text-blue-500 animate-spin"}):e.jsx(Ve,{className:"w-4 h-4 text-gray-400"})}),e.jsx("input",{ref:b,type:"text",value:c,onChange:d=>m(d.target.value),onKeyDown:X,className:"bg-gray-700 border border-gray-600 text-gray-100 text-sm rounded-lg focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500 block w-full pl-9 p-2 font-mono font-medium shadow-sm placeholder-gray-500",placeholder:"Scan Barcode...",autoComplete:"off",disabled:w})]}),e.jsx("button",{onClick:()=>{var d;return(d=W.current)==null?void 0:d.click()},disabled:E,className:"flex-shrink-0 bg-gray-700 border border-gray-600 text-gray-300 hover:bg-gray-600 rounded-lg p-2 flex items-center justify-center",children:E?e.jsx(fe,{className:"w-5 h-5 animate-spin"}):e.jsx(ft,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>{var d;return(d=C.current)==null?void 0:d.click()},disabled:S,className:"flex-shrink-0 bg-gray-700 border border-gray-600 text-gray-300 hover:bg-gray-600 rounded-lg p-2 flex items-center justify-center",children:S?e.jsx(fe,{className:"w-5 h-5 animate-spin"}):e.jsx(ra,{className:"w-5 h-5"})}),e.jsx("input",{type:"file",ref:W,accept:".xlsx, .xls, .csv",className:"hidden",onChange:be}),e.jsx("input",{type:"file",ref:C,accept:"image/*",capture:"environment",className:"hidden",onChange:we})]}),_e>0&&e.jsxs("button",{onClick:ve,disabled:J,className:"w-full flex items-center justify-center gap-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-bold px-4 py-2.5 rounded-lg shadow-sm transition-all animate-in fade-in slide-in-from-top-2",children:[J?e.jsx(fe,{size:16,className:"animate-spin"}):e.jsx(na,{size:16}),"Proses Kirim (",_e," Resi)"]})]})}),e.jsx("div",{className:"flex-1 overflow-auto p-2",children:je.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-48 text-gray-500 gap-2",children:[e.jsx(Ve,{size:40,className:"opacity-20"}),e.jsx("p",{className:"text-sm",children:"Belum ada resi yang di-scan"})]}):e.jsx("div",{className:"bg-gray-800 rounded-lg shadow-sm border border-gray-700 overflow-visible min-w-[1000px] hidden md:block",children:e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{className:"bg-gray-800 sticky top-0 z-10 shadow-sm text-[10px] font-bold text-gray-400 uppercase tracking-wider",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 border-b border-gray-700 w-10 text-center",children:e.jsx(dt,{size:16,className:"text-gray-600 mx-auto"})}),e.jsx("th",{className:"px-4 py-3 border-b border-gray-700",children:"Tanggal"}),e.jsx("th",{className:"px-4 py-3 border-b border-gray-700",children:"Resi"}),e.jsx("th",{className:"px-4 py-3 border-b border-gray-700",children:"Toko"}),e.jsx("th",{className:"px-4 py-3 border-b border-gray-700",children:"Via"}),e.jsx("th",{className:"px-4 py-3 border-b border-gray-700",children:"Pelanggan"}),e.jsx("th",{className:"px-4 py-3 border-b border-gray-700 min-w-[150px]",children:"Part.No (Edit)"}),e.jsx("th",{className:"px-4 py-3 border-b border-gray-700 min-w-[250px]",children:"Barang"}),e.jsx("th",{className:"px-4 py-3 border-b border-gray-700 text-center",children:"Qty"}),e.jsx("th",{className:"px-4 py-3 border-b border-gray-700 text-right min-w-[150px]",children:"Total (Edit)"}),e.jsx("th",{className:"px-4 py-3 border-b border-gray-700 text-center",children:"Status"}),e.jsx("th",{className:"px-4 py-3 border-b border-gray-700 text-center w-10",children:"+"}),e.jsx("th",{className:"px-4 py-3 border-b border-gray-700 text-center w-10",children:"Hapus"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-700 text-xs",children:je.map((d,P)=>{const T=d.status==="Terjual",I=d.status==="Siap Kirim",A=d.status==="Pending";d.status;const K=g.includes(d.resi),le=P*5;return e.jsxs("tr",{className:`transition-colors ${T?"bg-gray-900/50 opacity-60":K?"bg-blue-900/20":"hover:bg-gray-700/50"}`,children:[e.jsx("td",{className:"px-4 py-3 text-center",children:T?e.jsx(Ee,{size:16,className:"text-green-500 mx-auto"}):e.jsx("button",{onClick:()=>F(d.resi),disabled:!I,className:"focus:outline-none",children:K?e.jsx(dt,{size:16,className:"text-blue-500"}):e.jsx(la,{size:16,className:I?"text-gray-500 hover:text-blue-400":"text-gray-600 cursor-not-allowed"})})}),e.jsx("td",{className:"px-4 py-3 text-gray-500 font-mono whitespace-nowrap",children:new Date(d.tanggal).toLocaleDateString("id-ID")}),e.jsx("td",{className:"px-4 py-3 font-bold text-gray-200 font-mono select-all",children:d.resi}),e.jsx("td",{className:"px-4 py-3 text-gray-400 font-semibold",children:d.toko||"-"}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"px-2 py-0.5 rounded text-[10px] font-bold border bg-gray-700 text-gray-300 border-gray-600",children:d.ecommerce})}),e.jsx("td",{className:"px-4 py-3",children:T?e.jsx("span",{className:"text-gray-400",children:d.customer||"-"}):e.jsx("input",{ref:D=>{ae.current[le+0]=D},className:"w-full bg-transparent border-b border-transparent focus:border-blue-500 outline-none text-gray-100 p-1 text-xs focus:bg-gray-700/50 transition-colors",value:d.customer||"",onChange:D=>n(Se=>Se.map(ze=>ze.id===d.id?{...ze,customer:D.target.value}:ze)),onBlur:D=>Q(d.id,"customer",D.target.value),onKeyDown:D=>V(D,le+0)})}),e.jsx("td",{className:"px-4 py-3 relative",children:e.jsxs("div",{className:"flex items-center gap-1 relative",children:[T?e.jsx("span",{className:"font-mono text-gray-400",children:d.part_number}):e.jsx("input",{ref:D=>{ae.current[le+1]=D},className:"bg-transparent border-b border-transparent focus:border-blue-500 outline-none w-full font-mono text-gray-300 p-1 text-xs focus:bg-gray-700/50 transition-colors",placeholder:"Part No",value:d.part_number||"",onChange:D=>H(d.id,D.target.value,D),onFocus:D=>O(d.id,D.target.value,D.target),onKeyDown:D=>L(D,d.id,le+1),onBlur:D=>setTimeout(async()=>{xe===d.id&&de(null),await Q(d.id,"part_number",D.target.value)},200)}),!!d.part_number&&e.jsx($e,{size:10,className:"text-blue-400 flex-shrink-0"})]})}),e.jsx("td",{className:"px-4 py-3",children:T?e.jsx("span",{className:"text-gray-400 block max-h-20 overflow-y-auto",children:d.nama_barang||"-"}):e.jsx("textarea",{ref:D=>{ae.current[le+2]=D},rows:3,className:"w-full bg-transparent border border-transparent focus:border-blue-500 outline-none text-gray-100 p-1 text-xs focus:bg-gray-700/50 transition-colors resize-none overflow-hidden",value:d.nama_barang||"",onChange:D=>n(Se=>Se.map(ze=>ze.id===d.id?{...ze,nama_barang:D.target.value}:ze)),onBlur:D=>Q(d.id,"nama_barang",D.target.value),onKeyDown:D=>V(D,le+2)})}),e.jsx("td",{className:"px-4 py-3 text-center align-top",children:T?e.jsx("span",{className:"text-gray-400",children:d.quantity||"-"}):e.jsx("input",{ref:D=>{ae.current[le+3]=D},type:"text",inputMode:"numeric",className:"w-full bg-transparent border-b border-transparent focus:border-blue-500 outline-none text-gray-100 p-1 text-xs text-center focus:bg-gray-700/50 transition-colors [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none",value:d.quantity||"",onChange:D=>pe(d.id,"quantity",D.target.value),onBlur:D=>Q(d.id,"quantity",parseFloat(D.target.value)||0),onKeyDown:D=>V(D,le+3),placeholder:"0"})}),e.jsx("td",{className:"px-4 py-3 text-right align-top",children:T?e.jsx("span",{className:"text-gray-200 font-bold",children:d.harga_total?ge(d.harga_total):"-"}):e.jsx("input",{ref:D=>{ae.current[le+4]=D},type:"text",inputMode:"numeric",className:"w-full bg-transparent border-b border-transparent focus:border-blue-500 outline-none text-gray-100 p-1 text-xs text-right focus:bg-gray-700/50 transition-colors font-mono [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none min-w-[120px]",value:d.harga_total||"",onChange:D=>pe(d.id,"harga_total",D.target.value),onBlur:D=>Q(d.id,"harga_total",parseFloat(D.target.value)||0),onKeyDown:D=>V(D,le+4),placeholder:"0"})}),e.jsx("td",{className:"px-4 py-3 text-center whitespace-nowrap align-top",children:T?e.jsx("span",{className:"text-gray-400 font-bold bg-gray-700 px-2 py-0.5 rounded-full text-[10px]",children:"Terjual"}):I?e.jsxs("span",{className:"text-green-400 font-bold bg-green-900/30 px-2 py-0.5 rounded-full border border-green-800 text-[10px] flex items-center justify-center gap-1",children:[e.jsx(Ee,{size:10})," Siap"]}):A?e.jsxs("span",{className:"text-red-400 font-bold bg-red-900/30 px-2 py-0.5 rounded-full border border-red-800 text-[10px] flex items-center justify-center gap-1",children:[e.jsx(Qe,{size:10})," Data Kurang"]}):e.jsxs("span",{className:"text-yellow-400 font-bold bg-yellow-900/30 px-2 py-0.5 rounded-full border border-yellow-800 text-[10px] flex items-center justify-center gap-1",children:[e.jsx(oa,{size:10})," Order Masuk"]})}),e.jsx("td",{className:"px-4 py-3 text-center align-top",children:!T&&e.jsx("button",{onClick:()=>ce(d.id),className:"p-1 hover:bg-gray-600 rounded text-blue-400",children:ie===d.id?e.jsx(fe,{size:16,className:"animate-spin"}):e.jsx(Te,{size:16})})}),e.jsx("td",{className:"px-4 py-3 text-center align-top",children:!T&&e.jsx("button",{onClick:()=>k(d.id),className:"p-1 hover:bg-red-900/50 rounded text-red-400",children:e.jsx(st,{size:16})})})]},d.id||P)})})]})})}),xe!==null&&te.length>0&&f&&e.jsx("div",{className:"fixed z-[9999] bg-gray-800 border border-gray-600 rounded-lg shadow-2xl max-h-48 overflow-y-auto ring-1 ring-black/50",style:{top:f.top!==void 0?`${f.top}px`:"auto",bottom:f.bottom!==void 0?`${f.bottom}px`:"auto",left:`${f.left}px`,width:`${f.width}px`},children:te.map((d,P)=>e.jsxs("div",{ref:P===j?me:null,onMouseDown:T=>{T.preventDefault(),R(xe,d)},className:`px-3 py-2 text-xs cursor-pointer border-b border-gray-700 last:border-0 group transition-colors ${P===j?"bg-gray-700 border-l-2 border-orange-400":"hover:bg-gray-700"}`,children:[e.jsx("div",{className:"font-bold text-orange-400 font-mono text-sm group-hover:text-orange-300",children:d.partNumber}),e.jsx("div",{className:"text-gray-500 truncate group-hover:text-gray-300 text-[10px]",children:d.name})]},P))})]})},bt=()=>{const t=new Date,a=420*60*1e3;return new Date(t.getTime()+a).toISOString().replace("Z","")},ns=t=>{const a=new Date(t),o=a.getTimezoneOffset()*6e4;return new Date(a.getTime()-o).toISOString().slice(0,-1)},tt=t=>{try{const a=new Date(t||Date.now());return{date:a.toLocaleDateString("id-ID",{day:"numeric",month:"short",year:"numeric"}),time:a.toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit"})}}catch{return{date:"-",time:"-"}}},ls=t=>{switch(t){case"pending":return"bg-amber-900/30 text-amber-400 border-amber-900/50";case"processing":return"bg-blue-900/30 text-blue-400 border-blue-900/50";case"completed":return"bg-green-900/30 text-green-400 border-green-900/50";case"cancelled":return"bg-red-900/30 text-red-400 border-red-900/50";default:return"bg-gray-700 text-gray-300"}},os=t=>t==="cancelled"?"RETUR / BATAL":t==="completed"?"SELESAI":t==="processing"?"TERJUAL":t==="pending"?"BARU":t,Et=t=>{let a=t.customerName||"Tanpa Nama",o=`#${t.id.slice(0,8)}`,x="-",l="-";try{const n=a.match(/\(Resi: (.*?)\)/);n&&n[1]&&(o=n[1],a=a.replace(/\s*\(Resi:.*?\)/,""));const g=a.match(/\(Toko: (.*?)\)/);g&&g[1]&&(l=g[1],a=a.replace(/\s*\(Toko:.*?\)/,""));const s=a.match(/\(Via: (.*?)\)/);s&&s[1]&&(x=s[1],a=a.replace(/\s*\(Via:.*?\)/,"")),a=a.replace(/\(RETUR\)/i,"")}catch(n){console.error("Error parsing name",n)}return{cleanName:a.trim(),resiText:o,ecommerce:x,shopName:l}},qt=({currentPage:t,totalPages:a,onPageChange:o,currentCount:x,totalItems:l,startIndex:n})=>e.jsxs("div",{className:"px-4 py-3 bg-gray-800 border-t border-gray-700 flex items-center justify-between text-xs text-gray-500",children:[e.jsxs("div",{children:["Menampilkan ",n+1,"-",Math.min(n+100,l)," dari ",l," data"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>o(Math.max(1,t-1)),disabled:t===1,className:"p-1 rounded hover:bg-gray-700 text-gray-400 disabled:opacity-30 disabled:cursor-not-allowed",children:e.jsx(De,{size:16})}),e.jsxs("span",{className:"font-bold text-gray-200",children:["Halaman ",t]}),e.jsx("button",{onClick:()=>o(Math.min(a,t+1)),disabled:t>=a,className:"p-1 rounded hover:bg-gray-700 text-gray-400 disabled:opacity-30 disabled:cursor-not-allowed",children:e.jsx(Ce,{size:16})})]})]}),is=({orders:t,onUpdateStatus:a,openReturnModal:o,page:x,setPage:l})=>{const g=Math.ceil(t.length/100),s=(x-1)*100,c=t.slice(s,s+100);return t.length===0?e.jsxs("div",{className:"p-8 text-center text-gray-500",children:[e.jsx(Pe,{size:32,className:"opacity-20 mx-auto mb-2"}),e.jsx("p",{children:"Belum ada data pesanan"})]}):e.jsxs("div",{className:"flex-1 overflow-x-auto p-2 bg-gray-900",children:[e.jsx("div",{className:"bg-gray-800 rounded-lg shadow-sm border border-gray-700 overflow-hidden min-w-[1000px]",children:e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{className:"bg-gray-800 text-[10px] font-bold text-gray-400 uppercase tracking-wider border-b border-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 w-28",children:"Tanggal"}),e.jsx("th",{className:"px-3 py-2 w-32",children:"Resi / Toko"}),e.jsx("th",{className:"px-3 py-2 w-24",children:"Via"}),e.jsx("th",{className:"px-3 py-2 w-32",children:"Pelanggan"}),e.jsx("th",{className:"px-3 py-2 w-28",children:"Part No."}),e.jsx("th",{className:"px-3 py-2",children:"Barang"}),e.jsx("th",{className:"px-3 py-2 text-right w-16",children:"Qty"}),e.jsx("th",{className:"px-3 py-2 text-right w-24",children:"Satuan"}),e.jsx("th",{className:"px-3 py-2 text-right w-24",children:"Total"}),e.jsx("th",{className:"px-3 py-2 text-center w-24",children:"Status"}),e.jsx("th",{className:"px-3 py-2 text-center w-32",children:"Aksi"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-700 text-xs",children:c.map(m=>{if(!m)return null;const{cleanName:h,resiText:u,ecommerce:i,shopName:y}=Et(m),p=!u.startsWith("#"),z=tt(m.timestamp),B=Array.isArray(m.items)?m.items:[];return B.map((M,w)=>{const $=M.customPrice??M.price??0,E=$*(M.cartQuantity||0),_=M.customPrice!==void 0&&M.customPrice!==M.price;return e.jsxs("tr",{className:"hover:bg-blue-900/10 transition-colors group",children:[w===0&&e.jsxs(e.Fragment,{children:[e.jsxs("td",{rowSpan:B.length,className:"px-3 py-2 align-top border-r border-gray-700 bg-gray-800 group-hover:bg-blue-900/10",children:[e.jsx("div",{className:"font-bold text-gray-200",children:z.date}),e.jsx("div",{className:"text-[9px] text-gray-500 font-mono",children:z.time})]}),e.jsx("td",{rowSpan:B.length,className:"px-3 py-2 align-top border-r border-gray-700 font-mono text-[10px] bg-gray-800 group-hover:bg-blue-900/10",children:e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:`px-1.5 py-0.5 rounded w-fit font-bold border ${p?"bg-blue-900/30 text-blue-400 border-blue-800":"text-gray-500 bg-gray-700 border-gray-600"}`,children:u}),y!=="-"&&e.jsxs("div",{className:"flex items-center gap-1 text-gray-400 bg-gray-700 px-1.5 py-0.5 rounded w-fit border border-gray-600",children:[e.jsx(rt,{size:8}),e.jsx("span",{className:"uppercase truncate max-w-[80px]",children:y})]})]})}),e.jsx("td",{rowSpan:B.length,className:"px-3 py-2 align-top border-r border-gray-700 bg-gray-800 group-hover:bg-blue-900/10",children:i!=="-"?e.jsx("div",{className:"px-1.5 py-0.5 rounded bg-orange-900/30 text-orange-400 border border-orange-800 w-fit text-[9px] font-bold",children:i}):e.jsx("span",{className:"text-gray-600",children:"-"})}),e.jsx("td",{rowSpan:B.length,className:"px-3 py-2 align-top border-r border-gray-700 font-medium text-gray-200 bg-gray-800 group-hover:bg-blue-900/10 truncate max-w-[120px]",title:h,children:h})]}),e.jsx("td",{className:"px-3 py-2 align-top font-mono text-[10px] text-gray-500",children:M.partNumber||"-"}),e.jsx("td",{className:"px-3 py-2 align-top text-gray-300 font-medium truncate max-w-[180px]",title:M.name,children:M.name}),e.jsx("td",{className:"px-3 py-2 align-top text-right font-bold text-gray-300",children:M.cartQuantity||0}),e.jsx("td",{className:"px-3 py-2 align-top text-right text-gray-500 font-mono text-[10px]",children:e.jsx("div",{className:_?"text-orange-400 font-bold":"",children:ge($)})}),e.jsx("td",{className:"px-3 py-2 align-top text-right font-bold text-gray-200 font-mono text-[10px]",children:ge(E)}),w===0&&e.jsxs(e.Fragment,{children:[e.jsxs("td",{rowSpan:B.length,className:"px-3 py-2 align-top text-center border-l border-gray-700 bg-gray-800 group-hover:bg-blue-900/10",children:[e.jsx("div",{className:`inline-block px-2 py-0.5 rounded text-[9px] font-extrabold border uppercase mb-1 shadow-sm ${ls(m.status)}`,children:os(m.status)}),e.jsx("div",{className:"text-[10px] font-extrabold text-purple-400",children:ge(m.totalAmount||0)})]}),e.jsx("td",{rowSpan:B.length,className:"px-3 py-2 align-top text-center border-l border-gray-700 bg-gray-800 group-hover:bg-blue-900/10",children:e.jsxs("div",{className:"flex flex-col gap-1 items-center",children:[m.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>a(m.id,"processing"),className:"w-full py-1 bg-purple-700 text-white text-[9px] font-bold rounded hover:bg-purple-600 shadow-sm flex items-center justify-center gap-1",children:"Proses"}),e.jsx("button",{onClick:()=>a(m.id,"cancelled"),className:"w-full py-1 bg-gray-700 border border-gray-600 text-gray-400 text-[9px] font-bold rounded hover:bg-red-900/30 hover:text-red-400",children:"Tolak"})]}),m.status==="processing"&&e.jsx("button",{onClick:()=>o(m),className:"w-full py-1 bg-orange-900/30 border border-orange-800 text-orange-400 text-[9px] font-bold rounded hover:bg-orange-800 flex items-center justify-center gap-1",children:"Retur"})]})})]})]},`${m.id}-${w}`)})})})]})}),e.jsx(qt,{currentPage:x,totalPages:g,onPageChange:l,currentCount:c.length,totalItems:t.length,startIndex:s})]})},cs=({returRecords:t,openNoteModal:a,page:o,setPage:x})=>{const n=Math.ceil(t.length/100),g=(o-1)*100,s=t.slice(g,g+100);return t.length===0?e.jsxs("div",{className:"p-8 text-center text-gray-500",children:[e.jsx(Pe,{size:32,className:"opacity-20 mx-auto mb-2"}),e.jsx("p",{children:"Belum ada data retur"})]}):e.jsxs("div",{className:"flex-1 overflow-x-auto p-2 bg-gray-900",children:[e.jsx("div",{className:"bg-gray-800 rounded-lg shadow-sm border border-gray-700 overflow-hidden min-w-[1000px]",children:e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{className:"bg-gray-800 text-[10px] font-bold text-gray-400 uppercase tracking-wider border-b border-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 w-28",children:"Tanggal"}),e.jsx("th",{className:"px-3 py-2 w-32",children:"Resi / Toko"}),e.jsx("th",{className:"px-3 py-2 w-24",children:"Via"}),e.jsx("th",{className:"px-3 py-2 w-32",children:"Pelanggan"}),e.jsx("th",{className:"px-3 py-2 w-28",children:"Part No."}),e.jsx("th",{className:"px-3 py-2",children:"Barang"}),e.jsx("th",{className:"px-3 py-2 text-right w-16",children:"Qty"}),e.jsx("th",{className:"px-3 py-2 text-right w-24",children:"Satuan"}),e.jsx("th",{className:"px-3 py-2 text-right w-24",children:"Total"}),e.jsx("th",{className:"px-3 py-2 w-24 bg-red-900/20 text-red-400 border-l border-red-800",children:"Tgl Retur"}),e.jsx("th",{className:"px-3 py-2 text-center w-24 bg-red-900/20 text-red-400",children:"Status"}),e.jsx("th",{className:"px-3 py-2 text-center w-32",children:"Ket"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-700 text-xs",children:s.map(c=>{const m=tt(c.tanggal_pemesanan||""),h=tt(c.tanggal_retur);return e.jsxs("tr",{className:"hover:bg-red-900/10 transition-colors",children:[e.jsxs("td",{className:"px-3 py-2 align-top border-r border-gray-700",children:[e.jsx("div",{className:"font-bold text-gray-200",children:m.date}),e.jsx("div",{className:"text-[9px] text-gray-500 font-mono",children:m.time})]}),e.jsx("td",{className:"px-3 py-2 align-top font-mono text-[10px] text-gray-400",children:e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"font-bold text-blue-400 bg-blue-900/30 px-1.5 py-0.5 rounded border border-blue-800 w-fit",children:c.resi||"-"}),c.toko&&e.jsx("span",{className:"uppercase text-gray-400 bg-gray-700 px-1 py-0.5 rounded w-fit",children:c.toko})]})}),e.jsx("td",{className:"px-3 py-2 align-top",children:c.ecommerce?e.jsx("span",{className:"px-1.5 py-0.5 bg-orange-900/30 text-orange-400 text-[9px] font-bold rounded border border-orange-800",children:c.ecommerce}):"-"}),e.jsx("td",{className:"px-3 py-2 align-top font-medium text-gray-200 truncate max-w-[120px]",title:c.customer,children:c.customer||"Guest"}),e.jsx("td",{className:"px-3 py-2 align-top font-mono text-[10px] text-gray-500",children:c.part_number||"-"}),e.jsx("td",{className:"px-3 py-2 align-top text-gray-300 font-medium truncate max-w-[200px]",title:c.nama_barang,children:c.nama_barang}),e.jsxs("td",{className:"px-3 py-2 align-top text-right font-bold text-red-400",children:["-",c.quantity]}),e.jsx("td",{className:"px-3 py-2 align-top text-right font-mono text-[10px] text-gray-500",children:ge(c.harga_satuan)}),e.jsx("td",{className:"px-3 py-2 align-top text-right font-mono text-[10px] font-bold text-gray-300",children:ge(c.harga_total)}),e.jsxs("td",{className:"px-3 py-2 align-top border-l border-red-800 bg-red-900/10",children:[e.jsx("div",{className:"font-bold text-red-400 text-[10px]",children:h.date}),e.jsx("div",{className:"text-[9px] text-red-300/70 font-mono",children:h.time})]}),e.jsx("td",{className:"px-3 py-2 align-top text-center bg-red-900/10",children:e.jsx("span",{className:`px-1.5 py-0.5 rounded text-[9px] font-bold border uppercase ${c.status==="Full Retur"?"bg-red-900/30 text-red-400 border-red-800":"bg-orange-900/30 text-orange-400 border-orange-800"}`,children:c.status||"Retur"})}),e.jsx("td",{className:"px-3 py-2 align-top",children:e.jsxs("div",{className:"flex items-start justify-between gap-1 group/edit",children:[e.jsx("div",{className:"text-[10px] text-gray-500 italic truncate max-w-[100px]",children:c.keterangan||"-"}),e.jsx("button",{onClick:()=>a(c),className:"text-blue-400 hover:bg-blue-900/50 p-1 rounded opacity-0 group-hover/edit:opacity-100",children:e.jsx(ia,{size:12})})]})})]},`retur-${c.id}`)})})]})}),e.jsx(qt,{currentPage:o,totalPages:n,onPageChange:x,currentCount:s.length,totalItems:t.length,startIndex:g})]})},ds=({message:t,type:a,onClose:o})=>(r.useEffect(()=>{const x=setTimeout(o,3e3);return()=>clearTimeout(x)},[o]),e.jsxs("div",{className:`fixed top-4 left-1/2 -translate-x-1/2 z-[100] px-6 py-3 rounded-full shadow-xl flex items-center text-white text-sm font-medium animate-in fade-in slide-in-from-top-2 duration-300 border ${a==="success"?"bg-gray-800 border-gray-600 shadow-green-900/20":"bg-red-900/90 border-red-700"}`,children:[a==="success"?e.jsx(qe,{size:18,className:"mr-2 text-green-400"}):e.jsx(Qe,{size:18,className:"mr-2 text-red-300"}),t]})),xs=({orders:t=[],isLoading:a=!1,onUpdateStatus:o,onRefresh:x})=>{const[l,n]=r.useState("pending"),[g,s]=r.useState(""),[c,m]=r.useState(null),h=(f,v="success")=>m({msg:f,type:v}),[u,i]=r.useState(1),[y,p]=r.useState([]),[z,B]=r.useState(!1),[M,w]=r.useState(null),[$,E]=r.useState({}),[_,S]=r.useState(!1),[G,J]=r.useState(!1),[ee,ie]=r.useState(null),[ne,Y]=r.useState(""),[se,q]=r.useState(!1);r.useEffect(()=>{$a().then(p)},[l,t]),r.useEffect(()=>{s(""),i(1)},[l]);const te=Array.isArray(t)?t:[],re=r.useMemo(()=>{const f=g.toLowerCase();return l==="history"?y.filter(v=>!g||(v.resi+v.customer+v.nama_barang).toLowerCase().includes(f)).sort((v,b)=>new Date(b.tanggal_retur).getTime()-new Date(v.tanggal_retur).getTime()):l==="pending"||l==="processing"?te.filter(v=>(v==null?void 0:v.status)===l).filter(v=>!g||(v.id+v.customerName).toLowerCase().includes(f)).sort((v,b)=>(v.timestamp||0)-(b.timestamp||0)):[]},[te,y,l,g]),xe=f=>{ie({id:f.id?f.id.toString():"",resi:f.resi||"",currentText:f.keterangan||""}),Y(f.keterangan||""),J(!0)},de=async()=>{if(ee){q(!0);try{await Aa(ee.resi,ne)?(p(f=>f.map(v=>v.id&&v.id.toString()===ee.id||v.resi===ee.resi?{...v,keterangan:ne}:v)),J(!1)):h("Gagal menyimpan keterangan.","error")}catch(f){console.error("Error saving note:",f)}finally{q(!1)}}},j=f=>{w(f);const v={};f.items.forEach(b=>{v[b.id]=0}),E(v),B(!0)},N=async()=>{if(!M)return;const f=M.items.map(v=>{const b=$[v.id]||0;return b>0?{...v,cartQuantity:b}:null}).filter(Boolean);if(f.length!==0){S(!0);try{const{resiText:v,shopName:b,ecommerce:C,cleanName:W}=Et(M),ae=`${v} / ${b}`,me=M.timestamp?ns(M.timestamp):bt(),ue=bt(),pe=M.items.map(V=>{const L=f.find(Q=>Q.id===V.id),X=L?L.cartQuantity:0;return{...V,cartQuantity:(V.cartQuantity||0)-X}}).filter(V=>(V.cartQuantity||0)>0),ke=pe.length===0?"Full Retur":"Retur Sebagian";for(const V of f){const L=V.customPrice??V.price??0,X=await Be(V.partNumber);X&&await Ie({...X,quantity:X.quantity},{type:"in",qty:V.cartQuantity,ecommerce:C,resiTempo:ae,customer:W,price:L,isReturn:!0});const Q={tanggal_pemesanan:me,resi:v,toko:b,ecommerce:C,customer:W,part_number:V.partNumber,nama_barang:V.name,quantity:V.cartQuantity,harga_satuan:L,harga_total:L*V.cartQuantity,tanggal_retur:ue,status:ke,keterangan:"Retur Barang"};await Oa(Q)}if(pe.length===0)await Ze(M.id,M.items,M.totalAmount,"cancelled");else{const V=f.reduce((X,Q)=>X+(Q.customPrice??Q.price??0)*Q.cartQuantity,0);await Dt({id:`${M.id}-RET-${Date.now()}`,customerName:`${M.customerName} (RETUR)`,items:f,totalAmount:V,status:"cancelled",timestamp:Date.now()});const L=pe.reduce((X,Q)=>X+(Q.customPrice??Q.price??0)*Q.cartQuantity,0);await Ze(M.id,pe,L,"processing")}B(!1),w(null),n("history"),x&&x()}catch(v){console.error("Error processing return:",v)}finally{S(!1)}}};return e.jsxs("div",{className:"bg-gray-800 rounded-2xl shadow-sm border border-gray-700 min-h-[80vh] flex flex-col overflow-hidden relative text-gray-100",children:[c&&e.jsx(ds,{message:c.msg,type:c.type,onClose:()=>m(null)}),e.jsx(es,{isOpen:G,noteText:ne,setNoteText:Y,onClose:()=>J(!1),onSave:de,isSaving:se}),e.jsx(ts,{isOpen:z,order:M,returnQuantities:$,setReturnQuantities:E,onClose:()=>B(!1),onProcess:N,isProcessing:_}),e.jsxs("div",{className:"px-4 py-3 border-b border-gray-700 bg-gray-800 flex justify-between items-center",children:[e.jsx("div",{children:e.jsxs("h2",{className:"text-lg font-bold text-gray-100 flex items-center gap-2",children:[e.jsx(Pe,{className:"text-purple-400",size:20})," Manajemen Pesanan"]})}),e.jsx("div",{className:"flex items-center gap-3",children:a&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-blue-900/20 text-blue-400 rounded-full border border-blue-900/50 animate-pulse",children:[e.jsx(fe,{size:14,className:"animate-spin"}),e.jsx("span",{className:"text-xs font-medium",children:"Sinkronisasi Data..."})]})})]}),e.jsx("div",{className:"flex border-b border-gray-700 bg-gray-900/50",children:[{id:"pending",label:"Baru",icon:Tt,count:te.filter(f=>(f==null?void 0:f.status)==="pending").length,color:"text-amber-400"},{id:"scan",label:"Scan Resi",icon:Ve,count:0,color:"text-gray-300"},{id:"processing",label:"Terjual",icon:ye,count:0,color:"text-blue-400"},{id:"history",label:"Retur",icon:qe,count:y.length,color:"text-red-400"}].map(f=>e.jsxs("button",{onClick:()=>n(f.id),className:`flex-1 py-3 text-xs font-bold flex items-center justify-center gap-2 border-b-2 transition-all hover:bg-gray-800 relative ${l===f.id?"border-purple-500 text-purple-400 bg-gray-800":"border-transparent text-gray-500 hover:text-gray-300"}`,children:[e.jsx(f.icon,{size:16,className:l===f.id?f.color:""}),e.jsx("span",{children:f.label}),f.id==="pending"&&f.count>0&&e.jsx("span",{className:"bg-red-500 text-white text-[9px] px-1.5 py-0.5 rounded-full min-w-[16px] text-center",children:f.count})]},f.id))}),e.jsx("div",{className:"px-4 py-2 bg-gray-900 border-b border-gray-700",children:e.jsxs("div",{className:"relative max-w-sm w-full",children:[e.jsx($e,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:14}),e.jsx("input",{type:"text",placeholder:l==="scan"?"Cari Resi / Pelanggan...":"Cari Pesanan...",className:"w-full pl-9 pr-8 py-2 bg-gray-800 border border-gray-700 rounded-lg text-sm focus:ring-1 focus:ring-purple-900 focus:border-purple-500 outline-none transition-all text-white placeholder-gray-500",value:g,onChange:f=>s(f.target.value)}),g&&e.jsx("button",{onClick:()=>s(""),className:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-200",children:e.jsx(Ne,{size:12})})]})}),l==="scan"?e.jsx(rs,{onShowToast:h,onRefreshParent:x||(()=>{}),searchTerm:g}):l==="history"?e.jsx(cs,{returRecords:re,openNoteModal:xe,page:u,setPage:i}):e.jsx(is,{orders:re,onUpdateStatus:o,openReturnModal:j,page:u,setPage:i})]})},us=({orders:t,currentCustomerName:a})=>{const[o,x]=r.useState("pending"),l=s=>new Date(s).toLocaleDateString("id-ID",{day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"}),n=r.useMemo(()=>a?t.filter(s=>s.customerName.toLowerCase()===a.toLowerCase()):[],[t,a]),g=r.useMemo(()=>n.filter(s=>o==="pending"?s.status==="pending":o==="processing"?s.status==="processing":o==="completed"?s.status==="completed"||s.status==="cancelled":!1).sort((s,c)=>c.timestamp-s.timestamp),[n,o]);return e.jsxs("div",{className:"bg-gray-800 rounded-2xl shadow-sm border border-gray-700 min-h-[80vh] flex flex-col overflow-hidden text-gray-100",children:[e.jsxs("div",{className:"bg-gray-800 px-6 py-4 border-b border-gray-700",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-100 flex items-center gap-2",children:[e.jsx(Pe,{className:"text-blue-500"}),"Pesanan Saya"]}),e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["Halo, ",a||"Tamu",". Pantau status pesananmu di sini."]})]}),e.jsx("div",{className:"flex border-b border-gray-700 bg-gray-900/50",children:[{id:"pending",label:"Menunggu",icon:Tt,color:"text-orange-400",activeBorder:"border-orange-500"},{id:"processing",label:"Dikirim",icon:Nt,color:"text-blue-400",activeBorder:"border-blue-500"},{id:"completed",label:"Selesai",icon:qe,color:"text-green-400",activeBorder:"border-green-500"}].map(s=>{const c=o===s.id,m=n.filter(h=>s.id==="pending"?h.status==="pending":s.id==="processing"?h.status==="processing":s.id==="completed"?h.status==="completed"||h.status==="cancelled":!1).length;return e.jsxs("button",{onClick:()=>x(s.id),className:`flex-1 py-4 text-sm font-bold flex flex-col md:flex-row items-center justify-center gap-2 border-b-2 transition-all hover:bg-gray-800
                        ${c?`${s.activeBorder} bg-gray-800 text-gray-100`:"border-transparent text-gray-500 hover:text-gray-300"}
                    `,children:[e.jsxs("div",{className:"relative",children:[e.jsx(s.icon,{size:18,className:c?s.color:""}),m>0&&e.jsx("span",{className:"absolute -top-2 -right-2 bg-red-600 text-white text-[10px] w-4 h-4 rounded-full flex items-center justify-center shadow-sm",children:m})]}),e.jsx("span",{children:s.label})]},s.id)})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 bg-gray-900 space-y-4",children:g.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-gray-500",children:[e.jsx(Pe,{size:48,className:"opacity-20 mb-3"}),e.jsx("p",{className:"text-sm font-medium",children:"Tidak ada pesanan di status ini"})]}):g.map(s=>e.jsxs("div",{className:"bg-gray-800 p-4 rounded-xl shadow-[0_2px_8px_rgba(0,0,0,0.2)] border border-gray-700 hover:border-blue-500/30 transition-colors",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3 pb-3 border-b border-gray-700",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-[10px] text-gray-500 font-mono mb-1",children:["ORDER ID: #",s.id.slice(0,8)]}),e.jsx("p",{className:"text-xs font-bold text-gray-300 flex items-center gap-1",children:l(s.timestamp)})]}),e.jsx("span",{className:`px-2.5 py-1 rounded-md text-[10px] font-bold uppercase tracking-wide border ${s.status==="pending"?"bg-orange-900/30 text-orange-300 border-orange-800":s.status==="processing"?"bg-blue-900/30 text-blue-300 border-blue-800":s.status==="completed"?"bg-green-900/30 text-green-300 border-green-800":"bg-red-900/30 text-red-300 border-red-800"}`,children:s.status==="pending"?"Menunggu Konfirmasi":s.status==="processing"?"Sedang Dikirim":s.status==="completed"?"Selesai":"Dibatalkan"})]}),e.jsx("div",{className:"space-y-2 mb-4 bg-gray-900/50 p-3 rounded-lg border border-gray-700/50",children:s.items.map((c,m)=>e.jsxs("div",{className:"flex justify-between text-xs text-gray-300",children:[e.jsxs("div",{className:"flex items-center gap-2 overflow-hidden",children:[e.jsxs("span",{className:"bg-gray-700 text-gray-400 w-5 h-5 flex items-center justify-center rounded text-[9px] font-bold flex-shrink-0",children:[c.cartQuantity,"x"]}),e.jsx("span",{className:"truncate",children:c.name})]}),e.jsx("span",{className:"font-mono text-gray-400 whitespace-nowrap ml-2",children:ge(c.price*c.cartQuantity)})]},m))}),e.jsxs("div",{className:"flex justify-between items-center pt-1",children:[e.jsxs("div",{className:"text-xs text-gray-500",children:[s.status==="completed"&&e.jsxs("span",{className:"flex items-center text-green-400 gap-1",children:[e.jsx(qe,{size:12})," Transaksi Berhasil"]}),s.status==="cancelled"&&e.jsxs("span",{className:"flex items-center text-red-400 gap-1",children:[e.jsx(Qe,{size:12})," Dibatalkan"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"text-[10px] text-gray-500 block",children:"Total Belanja"}),e.jsx("span",{className:"text-sm font-extrabold text-gray-100",children:ge(s.totalAmount)})]})]})]},s.id))})]})},gs=()=>new Date().toISOString().split("T")[0],Je=t=>({id:t,tanggal:gs(),tempo:"CASH",customer:"",partNumber:"",namaBarang:"",brand:"",aplikasi:"",qtySaatIni:0,qtyMasuk:0,totalHarga:0,hargaSatuan:0,hargaJual:0,operation:"in",via:"",resiTempo:""}),Ue=t=>!!t.tanggal&&!!t.tempo&&!!t.customer.trim()&&!!t.partNumber&&!!t.namaBarang&&t.qtyMasuk>0&&t.totalHarga>0,ms=({onAddRow:t,onSaveAll:a,isSaving:o,validCount:x})=>e.jsxs("div",{className:"px-4 py-3 bg-gray-800 flex flex-col md:flex-row justify-between items-center gap-4 border-b border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 bg-green-900/30 rounded-lg",children:e.jsx(ca,{className:"text-green-400",size:20})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-gray-100",children:"Input Barang"}),e.jsx("p",{className:"text-[10px] text-gray-400",children:"Barang Masuk (Incoming Goods)"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 w-full md:w-auto justify-end",children:[e.jsxs("button",{onClick:t,className:"px-3 py-1.5 bg-gray-700 hover:bg-gray-600 text-gray-300 text-xs font-bold rounded-lg flex items-center gap-2 transition-colors",children:[e.jsx(Te,{size:14})," Tambah Baris"]}),e.jsxs("button",{onClick:a,disabled:o||x===0,className:"px-4 py-1.5 bg-green-600 hover:bg-green-700 text-white text-xs font-bold rounded-lg shadow flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:[o?e.jsx(fe,{size:14,className:"animate-spin"}):e.jsx(Fe,{size:14}),"Simpan (",x,")"]})]})]}),ps=({totalRows:t,currentPage:a,totalPages:o,onPageChange:x})=>t===0?null:e.jsxs("div",{className:"px-4 py-2 bg-gray-800 flex items-center justify-between text-[10px] text-gray-500 border-t border-gray-700 sticky bottom-0",children:[e.jsxs("div",{children:[t," Baris Data"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>x(Math.max(1,a-1)),disabled:a===1,className:"p-1 hover:bg-gray-700 rounded disabled:opacity-30",children:e.jsx(De,{size:14})}),e.jsxs("span",{children:["Hal ",a]}),e.jsx("button",{onClick:()=>x(Math.min(o,a+1)),disabled:a>=o,className:"p-1 hover:bg-gray-700 rounded disabled:opacity-30",children:e.jsx(Ce,{size:14})})]})]}),bs=({row:t,index:a,globalIndex:o,activeSearchIndex:x,suggestions:l,inputRefs:n,onPartNumberChange:g,onSelectItem:s,onUpdateRow:c,onRemoveRow:m,highlightedIndex:h,onSearchKeyDown:u,onGridKeyDown:i})=>{const y=Ue(t),p=r.useRef(null),[z,B]=r.useState(!1),w=o*8,$=["CASH","3 BLN","2 BLN","1 BLN"],E=S=>{const G=S.replace(/[^0-9]/g,""),J=G===""?0:parseInt(G,10),ee=t.totalHarga||0,ie=J>0?ee/J:0;c(t.id,{qtyMasuk:J,hargaSatuan:ie})},_=S=>{const G=S.replace(/[^0-9]/g,""),J=G===""?0:parseInt(G,10);if(t.qtyMasuk>0){const ee=J/t.qtyMasuk;c(t.id,{totalHarga:J,hargaSatuan:ee})}else c(t.id,{totalHarga:J,hargaSatuan:0})};return r.useEffect(()=>{x===a&&p.current&&p.current.scrollIntoView({block:"nearest",behavior:"smooth"})},[h,x,a]),e.jsxs(e.Fragment,{children:[e.jsxs("tr",{className:`hover:bg-gray-700/20 border-b border-gray-700/50 ${t.error?"bg-red-900/10":""}`,children:[e.jsx("td",{className:"px-2 py-1.5 text-gray-500 font-mono text-center text-[10px]",children:o+1}),e.jsx("td",{className:"px-2 py-1.5",children:e.jsx("input",{ref:S=>{n.current[w+0]=S},type:"date",className:"w-full bg-transparent px-2 py-1 text-xs text-gray-200 focus:outline-none focus:text-blue-400 placeholder-gray-600",value:t.tanggal,onChange:S=>c(t.id,"tanggal",S.target.value),onKeyDown:S=>i(S,w+0)})}),e.jsx("td",{className:"px-2 py-1.5",children:e.jsx("select",{ref:S=>{n.current[w+1]=S},className:"w-full bg-gray-700 px-2 py-1 text-xs text-gray-200 focus:outline-none focus:text-blue-400 rounded border border-gray-600",value:t.tempo,onChange:S=>c(t.id,"tempo",S.target.value),onKeyDown:S=>i(S,w+1),children:$.map(S=>e.jsx("option",{value:S,children:S},S))})}),e.jsx("td",{className:"px-2 py-1.5",children:e.jsx("input",{ref:S=>{n.current[w+2]=S},type:"text",className:"w-full bg-transparent px-2 py-1 text-xs text-gray-300 focus:outline-none focus:text-blue-400 placeholder-gray-600",value:t.customer,onChange:S=>c(t.id,"customer",S.target.value),onKeyDown:S=>i(S,w+2),placeholder:"Customer"})}),e.jsx("td",{className:"px-2 py-1.5 relative",children:e.jsxs("div",{className:"relative flex items-center gap-1",children:[e.jsx("input",{ref:S=>{n.current[w+3]=S},type:"text",className:`flex-1 bg-transparent px-2 py-1 text-xs font-mono text-gray-200 focus:outline-none focus:text-blue-400 font-bold placeholder-gray-600 ${t.error?"text-red-400":""}`,value:t.partNumber,onChange:S=>g(t.id,S.target.value),onKeyDown:S=>u(S,t.id),placeholder:"Part Number...",autoComplete:"off"}),(t.namaBarang||t.brand||t.aplikasi||t.qtySaatIni)&&e.jsx("button",{onClick:()=>B(!z),className:"text-blue-400 hover:text-blue-300 transition-colors",title:"Show item details",children:e.jsx(da,{size:12})}),x===a&&l.length>0&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 bg-gray-800 rounded-lg shadow-xl z-20 max-h-48 overflow-y-auto border border-gray-600",children:l.map((S,G)=>e.jsxs("div",{ref:G===h?p:null,className:`px-3 py-2 cursor-pointer border-b border-gray-700 last:border-0 transition-colors ${G===h?"bg-gray-700 border-l-2 border-orange-400":"hover:bg-gray-700"}`,onClick:()=>s(t.id,S),children:[e.jsx("div",{className:"font-bold text-orange-400 font-mono text-xs",children:S.partNumber}),e.jsx("div",{className:"text-gray-400 text-[10px] truncate",children:S.name})]},G))})]})}),e.jsx("td",{className:"px-2 py-1.5",children:e.jsx("input",{ref:S=>{n.current[w+4]=S},type:"text",inputMode:"numeric",className:"w-full bg-transparent px-1 py-1 text-xs font-bold text-right font-mono text-green-400 focus:outline-none focus:text-green-300 placeholder-gray-600",value:t.qtyMasuk||"",onChange:S=>E(S.target.value),onKeyDown:S=>i(S,w+4),placeholder:"0"})}),e.jsx("td",{className:"px-2 py-1.5",children:e.jsx("input",{ref:S=>{n.current[w+5]=S},type:"text",inputMode:"numeric",className:"w-full bg-transparent px-1 py-1 text-xs font-mono text-right text-orange-300 focus:outline-none focus:text-orange-400 placeholder-gray-600",value:t.totalHarga||"",onChange:S=>_(S.target.value),onKeyDown:S=>i(S,w+5),placeholder:"Total..."})}),e.jsx("td",{className:"px-2 py-1.5",children:e.jsx("div",{className:"px-1 py-1 text-xs font-mono text-right text-blue-300 opacity-70",title:"Auto-calculated: Total / Qty",children:ge(t.hargaSatuan)})}),e.jsx("td",{className:"px-2 py-1.5 text-center",children:e.jsx("div",{className:"flex items-center justify-center",children:t.isLoading?e.jsx(fe,{size:12,className:"animate-spin text-blue-400"}):t.error?e.jsxs("div",{className:"relative group",children:[e.jsx(at,{size:12,className:"text-red-400 cursor-help"}),e.jsx("div",{className:"absolute right-full top-0 mr-2 w-32 p-1.5 bg-red-900 text-red-100 text-[9px] rounded shadow-lg z-50 hidden group-hover:block",children:t.error})]}):y?e.jsx(Ee,{size:12,className:"text-green-400"}):e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-gray-700",title:"Belum Lengkap"})})}),e.jsx("td",{className:"px-2 py-1.5 text-center",children:e.jsx("button",{onClick:()=>m(t.id),className:"p-1 hover:text-red-300 text-red-400 transition-colors opacity-50 hover:opacity-100",children:e.jsx(st,{size:12})})})]}),z&&(t.namaBarang||t.brand||t.aplikasi||t.qtySaatIni!==void 0)&&e.jsx("tr",{className:"bg-blue-900/10 border-b border-gray-700/50",children:e.jsx("td",{colSpan:10,className:"px-4 py-2",children:e.jsxs("div",{className:"text-xs text-gray-300 grid grid-cols-4 gap-2",children:[t.namaBarang&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 text-[10px]",children:"Nama Barang:"}),e.jsx("div",{className:"font-medium text-gray-200",children:t.namaBarang})]}),t.brand&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 text-[10px]",children:"Brand:"}),e.jsx("div",{className:"font-medium text-gray-200",children:t.brand})]}),t.aplikasi&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 text-[10px]",children:"Aplikasi:"}),e.jsx("div",{className:"font-medium text-gray-200",children:t.aplikasi})]}),t.qtySaatIni!==void 0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 text-[10px]",children:"Qty Saat Ini:"}),e.jsx("div",{className:"font-medium text-green-400",children:t.qtySaatIni})]})]})})})]})},hs=({currentRows:t,startIndex:a,activeSearchIndex:o,suggestions:x,inputRefs:l,onPartNumberChange:n,onSelectItem:g,onUpdateRow:s,onRemoveRow:c,highlightedIndex:m,onSearchKeyDown:h,onGridKeyDown:u})=>e.jsx("div",{className:"flex-1 overflow-auto p-2",children:e.jsx("div",{className:"overflow-x-auto min-w-[1400px]",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-gray-800 text-[10px] font-bold text-gray-400 uppercase tracking-wider border-b border-gray-700 sticky top-0 z-10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 py-2 w-8 text-center",children:"#"}),e.jsx("th",{className:"px-2 py-2 w-28",children:"Tanggal"}),e.jsx("th",{className:"px-2 py-2 w-24",children:"Tempo"}),e.jsx("th",{className:"px-2 py-2 w-32",children:"Customer"}),e.jsx("th",{className:"px-2 py-2 w-48",children:"Part Number"}),e.jsx("th",{className:"px-2 py-2 w-16 text-right",children:"Qty Masuk"}),e.jsx("th",{className:"px-2 py-2 w-32 text-right",children:"Total Harga"}),e.jsx("th",{className:"px-2 py-2 w-28 text-right",children:"Harga Satuan"}),e.jsx("th",{className:"px-2 py-2 w-16 text-center",children:"Status"}),e.jsx("th",{className:"px-2 py-2 w-8 text-center"})]})}),e.jsx("tbody",{className:"text-xs",children:t.map((i,y)=>e.jsx(bs,{row:i,index:y,globalIndex:a+y,activeSearchIndex:o,suggestions:x,inputRefs:l,onPartNumberChange:n,onSelectItem:g,onUpdateRow:s,onRemoveRow:c,highlightedIndex:m,onSearchKeyDown:h,onGridKeyDown:u},i.id))})]})})}),ys=({refreshTrigger:t})=>{const[a,o]=r.useState([]),[x,l]=r.useState(!0),[n,g]=r.useState(""),[s,c]=r.useState("customer");r.useEffect(()=>{m()},[t]);const m=async()=>{l(!0);const i=await Ta();o(i),l(!1)},h=a.filter(i=>{var p,z;if(!n)return!0;const y=n.toLowerCase();return s==="customer"?(p=i.customer)==null?void 0:p.toLowerCase().includes(y):(z=i.part_number)==null?void 0:z.toLowerCase().includes(y)}),u=i=>{try{return new Date(i).toLocaleDateString("id-ID",{day:"2-digit",month:"short",year:"numeric"})}catch{return i}};return e.jsx("div",{className:"bg-gray-900 border-t-2 border-gray-700 p-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 bg-blue-900/30 rounded-lg",children:e.jsx(ye,{className:"text-blue-400",size:18})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-gray-100",children:"Riwayat Barang Masuk"}),e.jsx("p",{className:"text-[10px] text-gray-400",children:"Data yang sudah tersimpan"})]})]}),e.jsxs("div",{className:"text-sm text-gray-400",children:[h.length," dari ",a.length," item"]})]}),e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsxs("select",{value:s,onChange:i=>c(i.target.value),className:"px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-sm text-gray-200 focus:border-blue-500 outline-none",children:[e.jsx("option",{value:"customer",children:"Customer"}),e.jsx("option",{value:"part_number",children:"Part Number"})]}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx($e,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500",size:16}),e.jsx("input",{type:"text",placeholder:`Cari berdasarkan ${s==="customer"?"Customer":"Part Number"}...`,value:n,onChange:i=>g(i.target.value),className:"w-full pl-10 pr-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-sm text-gray-200 focus:border-blue-500 outline-none"})]})]}),x?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 mx-auto"}),e.jsx("p",{className:"mt-2 text-xs",children:"Memuat data..."})]}):h.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(ye,{size:40,className:"mx-auto opacity-20 mb-2"}),e.jsx("p",{className:"text-sm",children:n?"Tidak ada data yang sesuai":"Belum ada data barang masuk"})]}):e.jsx("div",{className:"overflow-x-auto rounded-lg border border-gray-700",children:e.jsxs("table",{className:"w-full text-left text-xs",children:[e.jsx("thead",{className:"bg-gray-800 text-gray-400 uppercase text-[10px] font-bold border-b border-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2",children:"Tanggal"}),e.jsx("th",{className:"px-3 py-2",children:"Tempo"}),e.jsx("th",{className:"px-3 py-2",children:"Customer"}),e.jsx("th",{className:"px-3 py-2",children:"Part Number"}),e.jsx("th",{className:"px-3 py-2",children:"Nama Barang"}),e.jsx("th",{className:"px-3 py-2",children:"Brand"}),e.jsx("th",{className:"px-3 py-2 text-right",children:"Qty Masuk"}),e.jsx("th",{className:"px-3 py-2 text-right",children:"Harga Satuan"}),e.jsx("th",{className:"px-3 py-2 text-right",children:"Total Harga"}),e.jsx("th",{className:"px-3 py-2 text-right",children:"Stock Akhir"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-700/50",children:h.map((i,y)=>e.jsxs("tr",{className:"hover:bg-gray-800/50 transition-colors",children:[e.jsx("td",{className:"px-3 py-2 text-gray-300",children:e.jsxs("div",{className:"flex items-center gap-1 text-[10px]",children:[e.jsx(jt,{size:10,className:"text-gray-500"}),u(i.created_at)]})}),e.jsx("td",{className:"px-3 py-2",children:e.jsx("span",{className:"px-2 py-0.5 bg-blue-900/30 text-blue-300 rounded text-[10px] font-bold",children:i.tempo})}),e.jsx("td",{className:"px-3 py-2 text-gray-300 font-medium",children:i.customer||"-"}),e.jsx("td",{className:"px-3 py-2",children:e.jsx("span",{className:"font-mono font-bold text-orange-400",children:i.part_number})}),e.jsx("td",{className:"px-3 py-2 text-gray-300 max-w-[200px] truncate",title:i.name,children:i.name}),e.jsx("td",{className:"px-3 py-2 text-gray-400 text-[10px]",children:i.brand||"-"}),e.jsx("td",{className:"px-3 py-2 text-right font-bold text-green-400",children:i.qty_masuk}),e.jsx("td",{className:"px-3 py-2 text-right font-mono text-blue-300",children:ge(i.harga_satuan)}),e.jsx("td",{className:"px-3 py-2 text-right font-mono text-orange-300 font-bold",children:ge(i.harga_total)}),e.jsx("td",{className:"px-3 py-2 text-right text-gray-400",children:i.stock_ahir})]},i.id||y))})]})})]})})},fs=({items:t,onRefresh:a,showToast:o})=>{const{selectedStore:x}=Oe(),[l,n]=r.useState([]),[g,s]=r.useState([]),[c,m]=r.useState(0),[h,u]=r.useState(null),[i,y]=r.useState(-1),[p,z]=r.useState(!1),[B,M]=r.useState(1),w=100,$=8,E=r.useRef(),_=r.useRef([]);r.useEffect(()=>{if(l.length===0){const j=Array.from({length:10}).map((N,f)=>Je(f+1));n(j),setTimeout(()=>{var N;(N=_.current[0])==null||N.focus()},100)}},[]);const S=(j,N)=>{if(g.length>0&&h!==null){if(j.key==="ArrowDown"){j.preventDefault(),y(v=>v<g.length-1?v+1:0);return}else if(j.key==="ArrowUp"){j.preventDefault(),y(v=>v>0?v-1:g.length-1);return}else if(j.key==="Enter"&&i>=0&&g[i]){j.preventDefault(),ee(N,g[i]);return}}const f=l.findIndex(v=>v.id===N);G(j,f*$+0)},G=(j,N)=>{if(j.ctrlKey||j.altKey||j.metaKey)return;let f=N;const v=l.length*$;switch(j.key){case"ArrowRight":j.target.selectionStart===j.target.value.length&&(j.preventDefault(),f=N+1);break;case"ArrowLeft":j.target.selectionStart===0&&(j.preventDefault(),f=N-1);break;case"ArrowUp":j.preventDefault(),f=N-$;break;case"ArrowDown":j.preventDefault(),f=N+$;break;case"Enter":j.preventDefault(),f=N+1;break;default:return}if(f>=0&&f<v){const b=_.current[f];b&&(b.focus(),setTimeout(()=>b.select(),0))}},J=(j,N)=>{n(v=>v.map(b=>b.id===j?{...b,partNumber:N.toUpperCase()}:b));const f=l.findIndex(v=>v.id===j);N.length>=2?(clearTimeout(E.current),E.current=setTimeout(()=>{const v=N.toLowerCase(),b=t.filter(C=>C.partNumber&&C.partNumber.toLowerCase().includes(v)).slice(0,10);s(b),u(f),y(-1)},300)):(s([]),u(null),y(-1))},ee=(j,N)=>{n(b=>b.map(C=>C.id===j?{...C,partNumber:N.partNumber,namaBarang:N.name,brand:N.brand,aplikasi:N.application,qtySaatIni:N.quantity,hargaSatuan:N.costPrice||0,hargaJual:N.price||0,error:void 0,totalHarga:(N.costPrice||0)*(C.qtyMasuk||1)}:C)),s([]),u(null),y(-1);const v=l.findIndex(b=>b.id===j)*$+4;setTimeout(()=>{var b,C;(b=_.current[v])==null||b.focus(),(C=_.current[v])==null||C.select()},50)},ie=()=>{const j=l.length>0?Math.max(...l.map(f=>f.id)):0;n(f=>[...f,Je(j+1)]);const N=Math.ceil((l.length+1)/w);N>B&&M(N),setTimeout(()=>{var v;const f=l.length*$;(v=_.current[f])==null||v.focus()},100)},ne=j=>{n(N=>N.filter(f=>f.id!==j))},Y=(j,N,f)=>{n(v=>v.map(b=>b.id!==j?b:typeof N=="string"?{...b,[N]:f,error:void 0}:{...b,...N,error:void 0}))},se=async j=>{if(!Ue(j))return Y(j.id,"error","Lengkapi semua kolom!"),!1;Y(j.id,"isLoading",!0);try{const N=await Be(j.partNumber,x);if(!N)return Y(j.id,"error","Item tidak ditemukan"),Y(j.id,"isLoading",!1),!1;const f={type:"in",qty:j.qtyMasuk,ecommerce:j.via||"-",resiTempo:j.resiTempo||"-",customer:j.customer,price:j.hargaSatuan,tanggal:j.tanggal,tempo:j.tempo};return await Ie({...N,name:j.namaBarang,quantity:N.quantity+j.qtyMasuk,costPrice:j.hargaSatuan||N.costPrice,price:j.hargaJual||N.price,lastUpdated:Date.now()},f,x)?(n(b=>b.filter(C=>C.id!==j.id)),o&&o(`Item ${j.partNumber} berhasil disimpan`,"success"),!0):(Y(j.id,"error","Gagal simpan"),!1)}catch(N){return console.error("Error saving row:",N),Y(j.id,"error","Error"),!1}finally{n(N=>N.map(f=>f.id===j.id?{...f,isLoading:!1}:f))}},q=async()=>{z(!0);const j=l.filter(b=>Ue(b));if(j.length===0){z(!1),o&&o("Isi lengkap data sebelum menyimpan!","error");return}const f=(await Promise.all(j.map(b=>se(b)))).filter(b=>b).length;if(o&&f>0&&o(`${f} item berhasil disimpan`,"success"),f>0&&(a&&a(),m(b=>b+1)),l.length-f===0){const b=Array.from({length:10}).map((C,W)=>Je(W+1));n(b)}z(!1)},te=l.filter(j=>Ue(j)).length,re=(B-1)*w,xe=l.slice(re,re+w),de=Math.ceil(l.length/w);return e.jsxs("div",{className:"bg-gray-800 flex flex-col overflow-hidden text-gray-100",children:[e.jsxs("div",{className:"min-h-[60vh]",children:[e.jsx(ms,{onAddRow:ie,onSaveAll:q,isSaving:p,validCount:te}),e.jsx(hs,{currentRows:xe,startIndex:re,activeSearchIndex:h,suggestions:g,inputRefs:_,onPartNumberChange:J,onSelectItem:ee,onUpdateRow:Y,onRemoveRow:ne,highlightedIndex:i,onSearchKeyDown:S,onGridKeyDown:G}),e.jsx(ps,{totalRows:l.length,currentPage:B,totalPages:de,onPageChange:M})]}),e.jsx(ys,{refreshTrigger:c})]})},js=({message:t,type:a,onClose:o})=>(r.useEffect(()=>{const x=setTimeout(o,3e3);return()=>clearTimeout(x)},[o]),e.jsxs("div",{className:`fixed top-4 left-1/2 -translate-x-1/2 z-[70] px-6 py-3 rounded-full shadow-xl flex items-center text-white text-sm font-medium animate-in fade-in slide-in-from-top-2 duration-300 border ${a==="success"?"bg-gray-800 border-gray-600 shadow-green-900/20":"bg-red-900/90 border-red-700"}`,children:[a==="success"?e.jsx(qe,{size:18,className:"mr-2 text-green-400"}):e.jsx(Qe,{size:18,className:"mr-2 text-red-300"}),t]})),Ns=1500,vs=({onSelectStore:t})=>{const[a,o]=r.useState(null),[x,l]=r.useState(!1),n=s=>{o(s),l(!0),setTimeout(()=>{t(s)},Ns)},g=Object.values(lt);return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 flex items-center justify-center p-4 font-sans relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 w-96 h-96 bg-blue-600/10 rounded-full blur-[120px] animate-pulse"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-96 h-96 bg-purple-600/10 rounded-full blur-[120px] animate-pulse delay-75"}),e.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[600px] h-[600px] bg-gradient-radial from-cyan-500/5 to-transparent rounded-full blur-3xl"}),e.jsxs("div",{className:"relative z-10 w-full max-w-6xl",children:[e.jsxs("div",{className:"text-center mb-12 animate-in fade-in slide-in-from-top duration-700",children:[e.jsx("div",{className:"flex justify-center mb-6",children:e.jsx("div",{className:"bg-gray-800/80 backdrop-blur-xl p-5 rounded-3xl shadow-2xl border border-gray-700/50",children:e.jsx(rt,{size:48,className:"text-blue-400",strokeWidth:1.5})})}),e.jsx("h1",{className:"text-5xl md:text-6xl font-extrabold text-white tracking-tight mb-4",children:"Pilih Toko"}),e.jsx("p",{className:"text-gray-400 text-lg md:text-xl",children:"Silakan pilih gudang atau toko yang ingin Anda akses"})]}),x&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-md animate-in fade-in duration-300",children:e.jsxs("div",{className:"text-center space-y-6",children:[e.jsx(fe,{size:64,className:"text-blue-400 animate-spin mx-auto"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-2xl font-bold text-white",children:"Memuat..."}),e.jsxs("p",{className:"text-gray-400",children:["Menghubungkan ke ",a==="mjm"?"MJM86":"BJW"," AUTOPART"]})]})]})}),e.jsx("div",{className:"grid md:grid-cols-2 gap-8 animate-in fade-in slide-in-from-bottom duration-700 delay-200",children:g.map((s,c)=>{const m=a===s.id,h=a&&a!==s.id;return e.jsxs("button",{onClick:()=>n(s.id),disabled:x,className:`
                  group relative overflow-hidden rounded-3xl p-8 
                  bg-gray-800/60 backdrop-blur-xl border-2 
                  transition-all duration-500 ease-out
                  ${m?"scale-110 border-"+s.theme.primary:"border-gray-700/50"}
                  ${h?"scale-90 opacity-30":"hover:scale-105 hover:border-"+s.theme.primary+"/50"}
                  ${!a&&!x?"hover:shadow-2xl hover:shadow-"+s.theme.glow:""}
                  disabled:cursor-not-allowed
                  animate-in fade-in slide-in-from-${c===0?"left":"right"} 
                  duration-700 delay-${300+c*100}
                `,style:{animationDelay:`${300+c*100}ms`},children:[e.jsx("div",{className:`absolute inset-0 bg-gradient-to-br ${s.theme.gradient} opacity-0 group-hover:opacity-100 transition-opacity duration-500`}),e.jsx("div",{className:`absolute inset-0 opacity-0 group-hover:opacity-20 transition-opacity duration-500 blur-xl bg-gradient-to-br from-${s.theme.primary} to-${s.theme.secondary}`}),e.jsxs("div",{className:"relative z-10 flex flex-col items-center space-y-6",children:[e.jsx("div",{className:`
                    w-40 h-40 rounded-2xl overflow-hidden 
                    bg-gray-700/50 flex items-center justify-center
                    transition-all duration-500
                    ${m?"animate-bounce":"group-hover:scale-110 group-hover:rotate-3"}
                    border-2 border-gray-600/50 group-hover:border-${s.theme.primary}/50
                  `,children:e.jsx("img",{src:s.logo,alt:s.fullName,className:"w-full h-full object-contain p-4",onError:u=>{const i=u.target;i.style.display="none";const y=i.parentElement;if(y){const p=document.createElement("span");p.className=`text-4xl font-bold text-${s.theme.primary}`,p.textContent=s.name,y.appendChild(p)}}})}),e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("h2",{className:`text-3xl font-extrabold text-white transition-colors duration-300 group-hover:text-${s.theme.primary}`,children:s.name}),e.jsx("p",{className:"text-xl font-bold text-gray-400 uppercase tracking-wider",children:"AUTOPART"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Klik untuk masuk"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:`w-8 h-2 rounded-full bg-${s.theme.primary}`}),e.jsx("div",{className:`w-8 h-2 rounded-full bg-${s.theme.secondary}`})]})]}),e.jsx("div",{className:"absolute inset-0 opacity-0 group-hover:opacity-100 transition-opacity duration-700",children:e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/5 to-transparent -translate-x-full group-hover:translate-x-full transition-transform duration-1000"})})]},s.id)})}),e.jsx("div",{className:"mt-12 text-center animate-in fade-in duration-700 delay-500",children:e.jsx("p",{className:"text-gray-500 text-sm",children:"Sistem Manajemen Inventory Otomatis"})})]})]})},ws=({store:t,onLogin:a,onBack:o})=>{const[x,l]=r.useState("guest"),[n,g]=r.useState(""),[s,c]=r.useState(""),[m,h]=r.useState("");if(!t)return null;const u=lt[t],i=u.theme,y=p=>{if(p.preventDefault(),h(""),!n.trim()){h("Nama harus diisi");return}if(x==="admin"){if(!s){h("Password harus diisi untuk Admin");return}if(s!==u.adminPassword){h("Password salah");return}}a(x,n.trim(),s)};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 flex items-center justify-center p-4 font-sans relative overflow-hidden animate-in fade-in slide-in-from-right duration-500",children:[e.jsx("div",{className:`absolute top-0 right-0 w-96 h-96 bg-${i.primary}/10 rounded-full blur-[120px] animate-pulse`}),e.jsx("div",{className:`absolute bottom-0 left-0 w-96 h-96 bg-${i.secondary}/10 rounded-full blur-[120px] animate-pulse delay-75`}),e.jsxs("div",{className:"bg-gray-800/80 backdrop-blur-xl p-8 rounded-3xl shadow-2xl w-full max-w-md border-2 border-gray-700/50 relative z-10",children:[e.jsx("button",{onClick:o,className:"absolute top-6 left-6 p-2 rounded-xl bg-gray-700/50 hover:bg-gray-700 text-gray-400 hover:text-white transition-all group",children:e.jsx(yt,{size:20,className:"group-hover:-translate-x-1 transition-transform"})}),e.jsxs("div",{className:"relative z-10 pt-8",children:[e.jsx("div",{className:"flex justify-center mb-6",children:e.jsx("div",{className:`bg-gray-700/50 p-4 rounded-2xl shadow-lg ring-2 ring-${i.primary}/30 border border-${i.primary}/20`,children:e.jsx("img",{src:u.logo,alt:u.fullName,className:"w-20 h-20 object-contain",onError:p=>{const z=p.target;z.style.display="none";const B=z.parentElement;if(B){const M=document.createElement("span");M.className=`text-3xl font-bold text-${i.primary}`,M.textContent=u.name,B.appendChild(M)}}})})}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:`text-4xl font-extrabold text-${i.primary} tracking-tight mb-1`,children:u.name}),e.jsx("p",{className:"text-gray-300 text-lg font-bold uppercase tracking-wider mb-1",children:"Autopart"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"Sukucadang Mobil"})]}),e.jsxs("div",{className:"flex gap-2 mb-6 p-1 bg-gray-700/50 rounded-xl",children:[e.jsxs("button",{type:"button",onClick:()=>{l("guest"),c(""),h("")},className:`
                flex-1 py-3 rounded-lg font-semibold transition-all duration-300
                flex items-center justify-center gap-2
                ${x==="guest"?`bg-${i.primary} text-gray-900 shadow-lg shadow-${i.glow}`:"text-gray-400 hover:text-gray-300"}
              `,children:[e.jsx(xa,{size:20}),"Pengunjung"]}),e.jsxs("button",{type:"button",onClick:()=>{l("admin"),h("")},className:`
                flex-1 py-3 rounded-lg font-semibold transition-all duration-300
                flex items-center justify-center gap-2
                ${x==="admin"?`bg-${i.primary} text-gray-900 shadow-lg shadow-${i.glow}`:"text-gray-400 hover:text-gray-300"}
              `,children:[e.jsx(ua,{size:20}),"Admin"]})]}),e.jsxs("form",{onSubmit:y,className:"space-y-5",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-xs font-semibold text-gray-400 uppercase tracking-wider ml-1",children:x==="admin"?"Nama Admin":"Nama Anda"}),e.jsxs("div",{className:"relative group",children:[e.jsx(Ye,{className:`absolute left-4 top-1/2 -translate-y-1/2 text-gray-500 group-focus-within:text-${i.primary} transition-colors`,size:20}),e.jsx("input",{type:"text",value:n,onChange:p=>g(p.target.value),className:`
                    w-full pl-12 pr-4 py-3.5 
                    bg-gray-700/50 border border-gray-600 rounded-xl 
                    focus:bg-gray-700 focus:border-${i.primary} focus:ring-4 focus:ring-${i.primary}/20 
                    outline-none transition-all font-medium text-gray-100 
                    placeholder:text-gray-500
                  `,placeholder:x==="admin"?"Masukkan nama admin...":"Masukkan nama Anda...",autoFocus:!0})]})]}),x==="admin"&&e.jsxs("div",{className:"space-y-1.5 animate-in slide-in-from-top duration-300",children:[e.jsx("label",{className:"text-xs font-semibold text-gray-400 uppercase tracking-wider ml-1",children:"Password"}),e.jsxs("div",{className:"relative group",children:[e.jsx(ga,{className:`absolute left-4 top-1/2 -translate-y-1/2 text-gray-500 group-focus-within:text-${i.primary} transition-colors`,size:20}),e.jsx("input",{type:"password",value:s,onChange:p=>c(p.target.value),className:`
                      w-full pl-12 pr-4 py-3.5 
                      bg-gray-700/50 border border-gray-600 rounded-xl 
                      focus:bg-gray-700 focus:border-${i.primary} focus:ring-4 focus:ring-${i.primary}/20 
                      outline-none transition-all font-medium text-gray-100 
                      placeholder:text-gray-500
                    `,placeholder:"Masukkan password..."})]})]}),m&&e.jsx("div",{className:"bg-red-500/10 border border-red-500/50 rounded-xl p-3 animate-in slide-in-from-top duration-300",children:e.jsx("p",{className:"text-red-400 text-sm text-center font-medium",children:m})}),e.jsxs("button",{type:"submit",className:`
                w-full bg-${i.primary} hover:bg-${i.hover} 
                text-gray-900 font-bold py-4 rounded-xl 
                shadow-lg shadow-${i.glow} hover:shadow-xl hover:shadow-${i.glow}
                transition-all active:scale-[0.98] 
                flex items-center justify-center gap-2 group
              `,children:[e.jsxs("span",{children:["Masuk ",x==="admin"?"sebagai Admin":"sebagai Pengunjung"]}),e.jsx(ma,{size:18,className:"group-hover:translate-x-1 transition-transform"})]})]}),e.jsx("div",{className:"mt-6 pt-6 border-t border-gray-700 text-center",children:e.jsx("p",{className:"text-xs text-gray-500",children:x==="admin"?"Mode Admin: Akses penuh ke semua fitur":"Mode Pengunjung: Akses terbatas untuk melihat katalog"})})]})]})]})},ks=({isAdmin:t,activeView:a,setActiveView:o,loading:x,onRefresh:l,loginName:n,onLogout:g,pendingOrdersCount:s,myPendingOrdersCount:c,storeConfig:m})=>{const[h,u]=r.useState(!1);return e.jsxs("div",{className:"bg-gray-800 border-b border-gray-700 px-4 py-3 flex justify-between items-center sticky top-0 z-50 shadow-sm backdrop-blur-md bg-gray-800/90",children:[e.jsxs("div",{className:"flex items-center gap-3 cursor-pointer group",onClick:()=>o(t?"inventory":"shop"),children:[e.jsx("div",{className:`${t?"bg-purple-600":"bg-blue-600"} text-white p-2.5 rounded-xl shadow-md group-hover:scale-105 transition-transform flex items-center justify-center`,children:h?t?e.jsx(pa,{size:20}):e.jsx(ye,{size:20}):e.jsx("img",{src:m.logo,alt:m.name,className:"w-5 h-5 object-contain",onError:()=>u(!0)})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold leading-none text-gray-100 text-lg",children:m.name}),e.jsx("div",{className:"text-[10px] font-bold text-gray-400 leading-none mt-0.5",children:"Autopart"}),e.jsx("div",{className:"text-[9px] text-gray-500 leading-none",children:m.subtitle}),e.jsx("div",{className:`text-[9px] font-bold mt-1 px-1.5 py-0.5 rounded-md inline-block ${t?"bg-purple-900/30 text-purple-300 border border-purple-800":"bg-blue-900/30 text-blue-300 border border-blue-800"}`,children:t?"ADMIN ACCESS":"STORE FRONT"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:l,className:"p-2 hover:bg-gray-700 rounded-full transition-colors active:scale-90",children:e.jsx(zt,{size:20,className:x?"animate-spin text-blue-400":"text-gray-400"})}),t?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>o("shop"),className:`hidden md:flex items-center gap-2 px-4 py-2 text-sm font-semibold rounded-full transition-all ${a==="shop"?"bg-purple-900/30 text-purple-300 ring-1 ring-purple-800":"text-gray-400 hover:bg-gray-700 hover:text-gray-200"}`,children:[e.jsx(Ae,{size:18})," Beranda"]}),e.jsxs("button",{onClick:()=>o("inventory"),className:`hidden md:flex items-center gap-2 px-4 py-2 text-sm font-semibold rounded-full transition-all ${a==="inventory"?"bg-purple-900/30 text-purple-300 ring-1 ring-purple-800":"text-gray-400 hover:bg-gray-700 hover:text-gray-200"}`,children:[e.jsx(ye,{size:18})," Gudang"]}),e.jsxs("button",{onClick:()=>o("quick_input"),className:`hidden md:flex items-center gap-2 px-4 py-2 text-sm font-semibold rounded-full transition-all ${a==="quick_input"?"bg-green-900/30 text-green-300 ring-1 ring-green-800":"text-gray-400 hover:bg-gray-700 hover:text-gray-200"}`,children:[e.jsx(Te,{size:18})," Input Barang"]}),e.jsxs("button",{onClick:()=>o("orders"),className:`hidden md:flex items-center gap-2 px-4 py-2 text-sm font-semibold rounded-full transition-all ${a==="orders"?"bg-purple-900/30 text-purple-300 ring-1 ring-purple-800":"text-gray-400 hover:bg-gray-700 hover:text-gray-200"}`,children:[e.jsx(Pe,{size:18})," Manajemen Pesanan ",s>0&&e.jsx("span",{className:"bg-red-500 text-white text-[10px] h-5 min-w-[20px] px-1.5 flex items-center justify-center rounded-full ml-1",children:s})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>o("shop"),className:`hidden md:flex items-center gap-2 px-4 py-2 text-sm font-semibold rounded-full transition-all ${a==="shop"?"bg-blue-900/30 text-blue-300 ring-1 ring-blue-800":"text-gray-400 hover:bg-gray-700 hover:text-gray-200"}`,children:[e.jsx(Rt,{size:18})," Belanja"]}),e.jsxs("button",{onClick:()=>o("orders"),className:`hidden md:flex items-center gap-2 px-4 py-2 text-sm font-semibold rounded-full transition-all ${a==="orders"?"bg-blue-900/30 text-blue-300 ring-1 ring-blue-800":"text-gray-400 hover:bg-gray-700 hover:text-gray-200"}`,children:[e.jsx(Pe,{size:18})," Pesanan ",c>0&&e.jsx("span",{className:"absolute -top-1 -right-1 w-2.5 h-2.5 bg-orange-500 rounded-full border border-gray-900"})]})]}),e.jsx("div",{className:"h-8 w-px bg-gray-700 mx-2"}),e.jsxs("button",{onClick:g,className:"flex items-center gap-2 px-3 py-2 text-gray-400 hover:bg-red-900/20 hover:text-red-400 rounded-lg transition-all",title:"Keluar",children:[e.jsx("span",{className:"text-xs font-semibold hidden lg:inline",children:n}),e.jsx(ba,{size:20})]})]})]})},Ss=({isAdmin:t,activeView:a,setActiveView:o,pendingOrdersCount:x,myPendingOrdersCount:l})=>e.jsx("div",{className:"md:hidden fixed bottom-0 left-0 right-0 bg-gray-800 border-t border-gray-700 pb-safe z-40 shadow-[0_-4px_20px_rgba(0,0,0,0.2)]",children:e.jsx("div",{className:`grid ${t?"grid-cols-4":"grid-cols-2"} h-16`,children:t?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>o("shop"),className:`flex flex-col items-center justify-center gap-1 ${a==="shop"?"text-purple-400":"text-gray-500 hover:text-gray-300"}`,children:[e.jsx(Ae,{size:22,className:a==="shop"?"fill-purple-900/50":""}),e.jsx("span",{className:"text-[10px] font-medium",children:"Beranda"})]}),e.jsxs("button",{onClick:()=>o("inventory"),className:`flex flex-col items-center justify-center gap-1 ${a==="inventory"?"text-purple-400":"text-gray-500 hover:text-gray-300"}`,children:[e.jsx(ye,{size:22,className:a==="inventory"?"fill-purple-900/50":""}),e.jsx("span",{className:"text-[10px] font-medium",children:"Gudang"})]}),e.jsxs("button",{onClick:()=>o("quick_input"),className:`relative flex flex-col items-center justify-center gap-1 ${a==="quick_input"?"text-green-400":"text-gray-500 hover:text-gray-300"}`,children:[e.jsx("div",{className:"relative",children:e.jsx(Te,{size:22,className:a==="quick_input"?"fill-green-900/50":""})}),e.jsx("span",{className:"text-[10px] font-medium",children:"Input"})]}),e.jsxs("button",{onClick:()=>o("orders"),className:`relative flex flex-col items-center justify-center gap-1 ${a==="orders"?"text-purple-400":"text-gray-500 hover:text-gray-300"}`,children:[e.jsxs("div",{className:"relative",children:[e.jsx(Pe,{size:22,className:a==="orders"?"fill-purple-900/50":""}),x>0&&e.jsx("span",{className:"absolute -top-1 -right-1 w-2.5 h-2.5 bg-red-500 rounded-full border border-gray-900"})]}),e.jsx("span",{className:"text-[10px] font-medium",children:"Pesanan"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>o("shop"),className:`flex flex-col items-center justify-center gap-1 ${a==="shop"?"text-blue-400":"text-gray-500 hover:text-gray-300"}`,children:[e.jsx(Rt,{size:22,className:a==="shop"?"fill-blue-900/50":""}),e.jsx("span",{className:"text-[10px] font-medium",children:"Belanja"})]}),e.jsxs("button",{onClick:()=>o("orders"),className:`relative flex flex-col items-center justify-center gap-1 ${a==="orders"?"text-blue-400":"text-gray-500 hover:text-gray-300"}`,children:[e.jsxs("div",{className:"relative",children:[e.jsx(Pe,{size:22,className:a==="orders"?"fill-blue-900/50":""}),l>0&&e.jsx("span",{className:"absolute -top-1 -right-1 w-2.5 h-2.5 bg-orange-500 rounded-full border border-gray-900"})]}),e.jsx("span",{className:"text-[10px] font-medium",children:"Pesanan"})]})]})})}),ht="stockmaster_my_customer_id",We="SYSTEM-BANNER-PROMO",Cs=()=>{const{selectedStore:t,userRole:a,userName:o,setStore:x,setUserRole:l,setUserName:n,logout:g,getStoreConfig:s}=Oe(),c=t!==null&&a!==null,m=a==="admin",h=o,u=s(),[i,y]=r.useState([]),[p,z]=r.useState([]),[B,M]=r.useState([]),[w,$]=r.useState(!1),[E,_]=r.useState("inventory"),[S,G]=r.useState(""),[J,ee]=r.useState(""),[ie,ne]=r.useState(!1),[Y,se]=r.useState(null),[q,te]=r.useState([]),[re,xe]=r.useState(null),[de,j]=r.useState(0),N=(k,O="success")=>xe({msg:k,type:O}),f=r.useMemo(()=>h.trim().toLowerCase()==="king fano",[h]),v=p.filter(k=>k.status==="pending").length,b=p.filter(k=>k.customerName===h&&k.status==="pending").length;r.useEffect(()=>{let k=localStorage.getItem(ht);k||(k="cust-"+gt(),localStorage.setItem(ht,k)),ee(k),c&&C()},[c]);const C=async()=>{$(!0);try{const k=await Mt(t),O=k.find(oe=>oe.partNumber===We);O&&G(O.imageUrl),y(k.filter(oe=>oe.partNumber!==We));const H=await ka();z(H);const R=await Sa();M(R),j(oe=>oe+1)}catch(k){console.error("Gagal memuat data:",k),N("Gagal sinkronisasi data","error")}$(!1)},W=k=>{x(k)},ae=(k,O)=>{l(k),n(O),_(k==="admin"?"inventory":"shop"),N(`Selamat Datang di ${t==null?void 0:t.toUpperCase()}, ${O}!`),C()},me=()=>{x(null),l(null),n("")},ue=()=>{g(),_("inventory")},pe=async k=>{$(!0);const O=Number(k.quantity)||0;let H={...Y,...k,quantity:O,initialStock:k.initialStock||0,qtyIn:k.qtyIn||0,qtyOut:k.qtyOut||0,lastUpdated:Date.now()};if(Y)await Ie(H)&&(N("Update berhasil!"),C());else{if(i.some(R=>R.partNumber===k.partNumber)){N("Part Number sudah ada!","error"),$(!1);return}await Xe(k)&&(N("Tersimpan!"),C())}ne(!1),se(null),$(!1)},ke=async k=>{const O=await Be(),H={partNumber:We,name:"SYSTEM BANNER PROMO",application:"DO NOT DELETE",brand:"SYS",price:0,costPrice:0,ecommerce:"",quantity:0,initialStock:0,qtyIn:0,qtyOut:0,shelf:"SYSTEM",imageUrl:k};let R=!1;if(O){const oe={...H,id:O.id};R=!!await Ie(oe,void 0)}else R=!!await Xe(H);R?(G(k),N("Banner diperbarui!")):N("Gagal update banner","error")},V=async k=>{confirm("Hapus Barang Permanen?")&&($(!0),await wa(k)&&(N("Dihapus"),C()),$(!1))},L=k=>{te(O=>O.find(R=>R.id===k.id)?O.map(R=>R.id===k.id?{...R,cartQuantity:R.cartQuantity+1}:R):[...O,{...k,cartQuantity:1}]),N("Masuk keranjang")},X=(k,O)=>{te(H=>H.map(R=>R.id===k?{...R,...O}:R))},Q=async k=>{k!==o&&!m&&n(k);const O=q.reduce((R,oe)=>R+(oe.customPrice??oe.price)*oe.cartQuantity,0),H={id:gt(),customerName:k,items:[...q],totalAmount:O,status:"pending",timestamp:Date.now()};$(!0),await Dt(H)?(N("Pesanan berhasil dibuat!"),te([]),_("orders"),await C()):N("Gagal membuat pesanan","error"),$(!1)},ve=async(k,O)=>{const H=p.find(U=>U.id===k);if(!H)return;$(!0),new Date().toISOString().split("T")[0];let R=H.customerName;const oe=R.match(/\(Resi: (.*?)\)/);oe&&(oe[1],R=R.replace(/\(Resi:.*?\)/,""));const we=R.match(/\(Toko: (.*?)\)/);we&&(we[1],R=R.replace(/\(Toko:.*?\)/,""));const be=R.match(/\(Via: (.*?)\)/);be&&(be[1],R=R.replace(/\(Via:.*?\)/,"")),R=R.trim()||"Pelanggan";for(const U of O){const Z=H.items.find(je=>je.id===U.itemId);if(!Z)continue;const he=await Be(Z.partNumber);if(he){const je=U.qty,_e=he.quantity+je,d={...he,qtyOut:Math.max(0,(he.qtyOut||0)-je),quantity:_e,lastUpdated:Date.now()};await Ie(d,void 0),await xt({hargaSatuan:Z.customPrice??Z.price,hargaTotal:(Z.customPrice??Z.price)*je})}}const F=H.items.map(U=>{const Z=O.find(he=>he.itemId===U.id);return Z?{...U,cartQuantity:U.cartQuantity-Z.qty}:U}).filter(U=>U.cartQuantity>0);F.reduce((U,Z)=>U+(Z.customPrice??Z.price)*Z.cartQuantity,0),F.length,await Ze(k,F)?(N("Retur berhasil diproses & Stok kembali!"),await C()):N("Gagal update data pesanan","error"),$(!1)},ce=async(k,O)=>{const H=p.find(F=>F.id===k);if(!H)return;let R=H.customerName;const oe=R.match(/\(Resi: (.*?)\)/);oe&&(oe[1],R=R.replace(/\(Resi:.*?\)/,""));const we=R.match(/\(Toko: (.*?)\)/);we&&(we[1],R=R.replace(/\(Toko:.*?\)/,""));const be=R.match(/\(Via: (.*?)\)/);if(be&&(be[1],R=R.replace(/\(Via:.*?\)/,"")),R=R.trim()||"Pelanggan",new Date().toISOString().split("T")[0],H.status==="pending"&&O==="processing"){if(await Ke(k,O)){for(const F of H.items){const U=await Be(F.partNumber);if(U){const Z=F.cartQuantity,he=Math.max(0,U.quantity-Z),je={...U,qtyOut:(U.qtyOut||0)+Z,quantity:he,lastUpdated:Date.now()};await Ie(je,void 0),await Ia({partNumber:U.partNumber,name:U.name,brand:U.brand,application:U.application,rak:U.shelf,hargaSatuan:F.customPrice??F.price,hargaTotal:(F.customPrice??F.price)*Z})}}N("Pesanan diproses, stok berkurang."),C()}}else if(O==="cancelled"&&H.status!=="cancelled"){if(await Ke(k,O)){if(H.status!=="pending"){for(const F of H.items){const U=await Be(F.partNumber);if(U){const Z=F.cartQuantity,he=U.quantity+Z,je={...U,qtyOut:Math.max(0,(U.qtyOut||0)-Z),quantity:he,lastUpdated:Date.now()};await Ie(je,void 0),await xt({hargaSatuan:F.customPrice??F.price,hargaTotal:(F.customPrice??F.price)*Z})}}N("Pesanan dibatalkan sepenuhnya.")}else N("Pesanan ditolak (Stok belum dipotong).");C()}}else await Ke(k,O)&&C()};return w&&i.length===0?e.jsxs("div",{className:"flex flex-col h-screen items-center justify-center bg-gray-900 font-sans text-gray-400 space-y-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-gray-700 border-t-blue-500 rounded-full animate-spin"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx(zt,{size:20,className:"text-blue-500 animate-pulse"})})]}),e.jsxs("div",{className:"text-center space-y-1",children:[e.jsx("p",{className:"font-medium text-gray-200",children:"Menghubungkan Database"}),e.jsx("p",{className:"text-xs",children:"Memuat Data..."})]})]}):t?!c||!a?e.jsx(ws,{store:t,onLogin:ae,onBack:me}):e.jsxs("div",{className:"min-h-screen bg-gray-900 flex flex-col font-sans text-gray-100",children:[re&&e.jsx(js,{message:re.msg,type:re.type,onClose:()=>xe(null)}),u&&e.jsx(ks,{isAdmin:m,activeView:E,setActiveView:_,loading:w,onRefresh:()=>{C(),N("Data diperbarui")},loginName:h,onLogout:ue,pendingOrdersCount:v,myPendingOrdersCount:b,storeConfig:u}),e.jsxs("div",{className:"flex-1 overflow-y-auto bg-gray-900",children:[E==="shop"&&e.jsx(Za,{items:i,cart:q,isAdmin:m,isKingFano:f,bannerUrl:S,onAddToCart:L,onRemoveFromCart:k=>te(O=>O.filter(H=>H.id!==k)),onUpdateCartItem:X,onCheckout:Q,onUpdateBanner:ke}),E==="inventory"&&m&&e.jsx(Qa,{items:i,orders:p,history:B,refreshTrigger:de,onViewOrders:()=>_("orders"),onAddNew:()=>{se(null),ne(!0)},onEdit:k=>{se(k),ne(!0)},onDelete:V}),E==="quick_input"&&m&&e.jsx(fs,{items:i,onRefresh:C,showToast:N}),E==="orders"&&m&&e.jsx(xs,{orders:p,isLoading:w,onUpdateStatus:ce,onProcessReturn:ve,onRefresh:C}),E==="orders"&&!m&&e.jsx(us,{orders:p.filter(k=>k.customerName===h)}),ie&&m&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 p-4 backdrop-blur-sm animate-in fade-in",children:e.jsx("div",{className:"w-full max-w-4xl max-h-[90vh] overflow-y-auto rounded-2xl shadow-2xl",children:e.jsx(Lt,{initialData:Y||void 0,onCancel:()=>{ne(!1),se(null)},onSuccess:k=>{pe(k)}})})})]}),e.jsx(Ss,{isAdmin:m,activeView:E,setActiveView:_,pendingOrdersCount:v,myPendingOrdersCount:b})]}):e.jsx(vs,{onSelectStore:W})},Ps=()=>e.jsx(Ht,{children:e.jsx(Ea,{children:e.jsx(Cs,{})})}),_t=document.getElementById("root");if(!_t)throw new Error("Could not find root element to mount to");const Is=Ft.createRoot(_t);Is.render(e.jsx(Qt.StrictMode,{children:e.jsx(Ps,{})}));
